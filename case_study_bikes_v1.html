<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Case study: How does a bike-share navigate speedy success?</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="case_study_bikes_v1_files/libs/clipboard/clipboard.min.js"></script>
<script src="case_study_bikes_v1_files/libs/quarto-html/quarto.js"></script>
<script src="case_study_bikes_v1_files/libs/quarto-html/popper.min.js"></script>
<script src="case_study_bikes_v1_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="case_study_bikes_v1_files/libs/quarto-html/anchor.min.js"></script>
<link href="case_study_bikes_v1_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="case_study_bikes_v1_files/libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="case_study_bikes_v1_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="case_study_bikes_v1_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="case_study_bikes_v1_files/libs/bootstrap/bootstrap-1bc8a17f135ab3d594c857e9f48e611b.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-full">

<main class="content column-page" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Case study: How does a bike-share navigate speedy success?</h1>
</div>



<div class="quarto-title-meta column-page">

    
  
    
  </div>
  


</header>


<section id="executive-summary" class="level1">
<h1>Executive Summary</h1>
<p>This analysis examines Cyclistic bike share usage patterns to understand the behavioral differences between casual riders and annual members, with the goal of developing strategies to convert casual users into profitable annual memberships.</p>
<p><strong>Key Findings:</strong></p>
<ul>
<li><p>Members represent 63.5% of total rides but take shorter trips (11.9 minutes average vs.&nbsp;19.6 minutes for casual users)</p></li>
<li><p>Casual users exhibit recreational usage patterns: higher weekend activity, longer summer rides, and concentration at tourist attractions</p></li>
<li><p>Members show commuter-focused behavior: weekday peaks during rush hours, consistent year-round usage, and stations near business districts</p></li>
<li><p>Geographic analysis reveals casual users frequent tourist destinations (Millennium Park, Museum Campus, Lake Shore) while members use stations in business areas (River North, West Loop)</p></li>
</ul>
<p><strong>Business Impact:</strong> The data clearly shows two distinct user segments with different needs and usage patterns, providing clear opportunities for targeted conversion strategies.</p>
</section>
<section id="environement-preparation" class="level1">
<h1>Environement Preparation</h1>
<p>All required R packages have been installed and loaded in advance. Therefore, in the code chunks below, we directly proceed with the analysis without including repeated install.packages() or library() calls.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Loading Libraries</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(hms)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(geosphere)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tibble)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(FNN)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(leaflet)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(s2)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gridExtra)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(viridis)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="data-collection" class="level1">
<h1>Data Collection</h1>
<p>The dataset used in this analysis consists of bike share ride data collected from the Divvy bike-sharing system in Chicago, provided by Lyft and made publicly available through the Divvy Trip Data portal. The data covers a full year of bike trips, from April of the current year going back 12 months, with each month’s data stored in a separate CSV file. Each file contains thousands of individual ride records, including information such as ride duration, start and end time, station locations, and rider type. After downloading the 12 monthly CSV files, they were merged into a single dataset named all_trips, resulting in a combined total of 5,779,568 ride records. This unified dataset serves as the foundation for the subsequent data cleaning, exploration, and analysis tasks.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Folder path</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>data_folder <span class="ot">&lt;-</span> <span class="st">"C://Users//aymen//Desktop//case_studies//Case_study_1//Data_R//"</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># List of all CSV files</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>csv_files <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="at">path =</span> data_folder, <span class="at">pattern =</span> <span class="st">"*.csv"</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Read and merge all CSVs as data.table</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>all_trips <span class="ot">&lt;-</span> <span class="fu">rbindlist</span>(<span class="fu">lapply</span>(csv_files, <span class="cf">function</span>(x) <span class="fu">fread</span>(x, <span class="at">na.strings =</span> <span class="fu">c</span>(<span class="st">""</span>, <span class="st">"NA"</span>))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This dataset contains 13 variables detailing bike-sharing trips. Each row represents a single ride, including information such as ride ID, type of bike (rideable_type), start and end timestamps (started_at, ended_at), station details (names, IDs, and coordinates), and rider type (member_casual). It includes both members and casual users and offers rich temporal and spatial data for analysis.This dataset contains 13 variables detailing bike-sharing trips. Each row represents a single ride, including information such as ride ID, type of bike (rideable_type), start and end timestamps (started_at, ended_at), station details (names, IDs, and coordinates), and rider type (member_casual). It includes both members and casual users and offers rich temporal and spatial data for analysis.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Look at the structure of the data frame</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(all_trips)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 5,779,568
Columns: 13
$ ride_id            &lt;chr&gt; "743252713F32516B", "BE90D33D2240C614", "D47BBDDE7C…
$ rideable_type      &lt;chr&gt; "classic_bike", "electric_bike", "classic_bike", "c…
$ started_at         &lt;dttm&gt; 2024-04-22 19:08:21, 2024-04-11 06:19:24, 2024-04-…
$ ended_at           &lt;dttm&gt; 2024-04-22 19:12:56, 2024-04-11 06:22:21, 2024-04-…
$ start_station_name &lt;chr&gt; "Aberdeen St &amp; Jackson Blvd", "Aberdeen St &amp; Jackso…
$ start_station_id   &lt;chr&gt; "13157", "13157", "TA1307000107", "13157", "TA13070…
$ end_station_name   &lt;chr&gt; "Desplaines St &amp; Jackson Blvd", "Desplaines St &amp; Ja…
$ end_station_id     &lt;chr&gt; "15539", "15539", "13249", "15539", "TA1308000029",…
$ start_lat          &lt;dbl&gt; 41.87773, 41.87772, 41.96167, 41.87773, 41.96161, 4…
$ start_lng          &lt;dbl&gt; -87.65479, -87.65496, -87.65464, -87.65479, -87.654…
$ end_lat            &lt;dbl&gt; 41.87812, 41.87812, 41.95606, 41.87812, 41.88683, 4…
$ end_lng            &lt;dbl&gt; -87.64395, -87.64395, -87.66884, -87.64395, -87.622…
$ member_casual      &lt;chr&gt; "member", "member", "member", "member", "member", "…</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(all_trips)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   ride_id          rideable_type        started_at                 
 Length:5779568     Length:5779568     Min.   :2024-04-01 00:00:42  
 Class :character   Class :character   1st Qu.:2024-06-19 09:30:04  
 Mode  :character   Mode  :character   Median :2024-08-17 13:20:39  
                                       Mean   :2024-08-25 19:23:44  
                                       3rd Qu.:2024-10-13 05:26:14  
                                       Max.   :2025-03-31 23:50:16  
                                                                    
    ended_at                   start_station_name start_station_id  
 Min.   :2024-04-01 00:07:30   Length:5779568     Length:5779568    
 1st Qu.:2024-06-19 09:47:55   Class :character   Class :character  
 Median :2024-08-17 13:41:40   Mode  :character   Mode  :character  
 Mean   :2024-08-25 19:40:47                                        
 3rd Qu.:2024-10-13 05:44:47                                        
 Max.   :2025-03-31 23:59:21                                        
                                                                    
 end_station_name   end_station_id       start_lat       start_lng     
 Length:5779568     Length:5779568     Min.   :41.64   Min.   :-87.91  
 Class :character   Class :character   1st Qu.:41.88   1st Qu.:-87.66  
 Mode  :character   Mode  :character   Median :41.90   Median :-87.64  
                                       Mean   :41.90   Mean   :-87.65  
                                       3rd Qu.:41.93   3rd Qu.:-87.63  
                                       Max.   :42.07   Max.   :-87.52  
                                                                       
    end_lat         end_lng        member_casual     
 Min.   :16.06   Min.   :-144.05   Length:5779568    
 1st Qu.:41.88   1st Qu.: -87.66   Class :character  
 Median :41.90   Median : -87.64   Mode  :character  
 Mean   :41.90   Mean   : -87.65                     
 3rd Qu.:41.93   3rd Qu.: -87.63                     
 Max.   :87.96   Max.   : 152.53                     
 NA's   :6589    NA's   :6589                        </code></pre>
</div>
</div>
</section>
<section id="data-cleaning-invalid-stations-coordinates" class="level1">
<h1><strong>Data cleaning (Invalid Stations Coordinates</strong>)</h1>
<p>I noticed a number of incorrect coordinate values (end_lat &amp; end_lng) in the dataset that fall outside the expected geographic bounds of Chicago.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define valid Chicago lat/lng bounds</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>lat_min <span class="ot">&lt;-</span> <span class="fl">41.64</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>lat_max <span class="ot">&lt;-</span> <span class="fl">42.07</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>lng_min <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fl">87.94</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>lng_max <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fl">87.52</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract invalid records</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>invalid_records <span class="ot">&lt;-</span> all_trips[<span class="sc">!</span><span class="fu">is.na</span>(end_lat) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(end_lng) <span class="sc">&amp;</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>                               ((end_lat <span class="sc">&lt;</span> lat_min) <span class="sc">|</span> </span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>                                (end_lat <span class="sc">&gt;</span> lat_max) <span class="sc">|</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>                                (end_lng <span class="sc">&lt;</span> lng_min) <span class="sc">|</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>                                (end_lng <span class="sc">&gt;</span> lng_max)</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>                                )]</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Count invalid records</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>num_invalid_records <span class="ot">&lt;-</span> <span class="fu">nrow</span>(invalid_records)</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Number of incorrect records:"</span>, num_invalid_records, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Number of incorrect records: 219 </code></pre>
</div>
</div>
<p>I found 219 incorrect coordinate values. I will keep these records but replace their end_lat and end_lng values with NA to preserve other valuable information. These cases likely represent bikes that were not returned properly.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace incorrect coordinates with NA</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>all_trips[<span class="sc">!</span><span class="fu">is.na</span>(end_lat) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(end_lng) <span class="sc">&amp;</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>            ((end_lat <span class="sc">&lt;</span> lat_min) <span class="sc">|</span> </span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>             (end_lat <span class="sc">&gt;</span> lat_max) <span class="sc">|</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>             (end_lng <span class="sc">&lt;</span> lng_min) <span class="sc">|</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>             (end_lng <span class="sc">&gt;</span> lng_max)), <span class="st">`</span><span class="at">:=</span><span class="st">`</span>(<span class="at">end_lat =</span> <span class="cn">NA</span>, <span class="at">end_lng =</span> <span class="cn">NA</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="data-cleaning-missing-data" class="level1">
<h1>Data cleaning (Missing data)</h1>
<p>A check for missing data has been performed across all columns.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Count NAs per column</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>na_counts <span class="ot">&lt;-</span> <span class="fu">colSums</span>(<span class="fu">is.na</span>(all_trips))</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Show only columns with at least one NA</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>na_counts[na_counts <span class="sc">&gt;</span> <span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>start_station_name   start_station_id   end_station_name     end_station_id 
           1091230            1091230            1120919            1120919 
           end_lat            end_lng 
              6808               6808 </code></pre>
</div>
</div>
<p>The 6,808 missing values in end_lat and end_lng cannot be filled, as both the station name and station ID are also missing for those records. Without any identifiable information, it is not possible to infer the corresponding coordinates for these trips.</p>
<p>The rest of the stations with missing names were found to have coordinates rounded to only two decimal places, which introduces a significant error margin of approximately 1.1 kilometers. Due to this level of imprecision, it is not possible to reliably identify the exact station name based on these coordinates.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># see the coordinates of the missing end stations</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>missing_stations <span class="ot">&lt;-</span> all_trips[<span class="fu">is.na</span>(end_station_name)]</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(missing_stations<span class="sc">$</span>end_lat, <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 41.86 41.91 41.89 41.89 41.88 41.89 41.98 41.88 41.94 41.93</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(missing_stations<span class="sc">$</span>end_lng, <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] -87.66 -87.65 -87.61 -87.66 -87.63 -87.71 -87.69 -87.62 -87.67 -87.71</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># the same applies for start stations</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>All records were retained despite the missing station information. It was observed that 18.88% of start station data and 19.39% of end station data were missing. In total, 29.06% of rides had either start or end station information missing, while 9.22% had both missing. Removing these records would have resulted in a substantial loss of data. By keeping them, the integrity of other key attributes—such as trip duration, time, and user-related details—was maintained, ensuring a more robust and comprehensive analysis.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>total_records <span class="ot">&lt;-</span> <span class="fu">nrow</span>(all_trips)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co">#count records with missing stations</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>missing_start <span class="ot">=</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(all_trips<span class="sc">$</span>start_station_name))</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>missing_end <span class="ot">=</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(all_trips<span class="sc">$</span>end_station_name))</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>missing_start_or_end <span class="ot">=</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(all_trips<span class="sc">$</span>start_station_name) <span class="sc">|</span> <span class="fu">is.na</span>(all_trips<span class="sc">$</span>end_station_name))</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>missing_start_and_end <span class="ot">=</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(all_trips<span class="sc">$</span>start_station_name) <span class="sc">&amp;</span> <span class="fu">is.na</span>(all_trips<span class="sc">$</span>end_station_name))</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Number of missing start stations info:"</span>, missing_start, </span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"percentage:"</span>, (missing_start <span class="sc">/</span> total_records) <span class="sc">*</span> <span class="dv">100</span>, <span class="st">"%</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Number of missing start stations info: 1091230 percentage: 18.88082 %</code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Number of missing end stations info:"</span>, missing_end, </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"percentage:"</span>, (missing_end <span class="sc">/</span> total_records) <span class="sc">*</span> <span class="dv">100</span>, <span class="st">"%</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Number of missing end stations info: 1120919 percentage: 19.39451 %</code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Number of rides with either start or end stations info missing:"</span>, missing_start_or_end, </span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"percentage:"</span>, (missing_start_or_end <span class="sc">/</span> total_records) <span class="sc">*</span> <span class="dv">100</span>, <span class="st">"%</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Number of rides with either start or end stations info missing: 1679432 percentage: 29.05809 %</code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Number of rides with both start and end stations info missing:"</span>, missing_start_and_end, </span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"percentage:"</span>, (missing_start_and_end <span class="sc">/</span> total_records) <span class="sc">*</span> <span class="dv">100</span>, <span class="st">"%</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Number of rides with both start and end stations info missing: 532717 percentage: 9.217246 %</code></pre>
</div>
</div>
<p>Rides with missing station names were flagged using two new columns: missing_start_stations_flag and missing_end_stations_flag.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>all_trips[,<span class="st">`</span><span class="at">:=</span><span class="st">`</span>(<span class="at">missing_start_stations_flag =</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(start_station_name), <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">missing_end_stations_flag =</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(end_station_name), <span class="dv">1</span>, <span class="dv">0</span>))]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="data-cleaning-duplicate-rides" class="level1">
<h1>Data cleaning (Duplicate rides)</h1>
<p>During the initial examination of the all_trips dataset, it was found that there were 211 duplicate ride IDs. Upon further inspection, each of these duplicated entries had identical values across all columns, indicating that they were likely the result of accidental double entries in the data source. To maintain data integrity while avoiding redundancy, the duplicates were removed by keeping only one instance of each duplicated record and discarding the others. This ensures that the dataset accurately reflects the true number of unique bike share rides.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co">#check for duplicate rides</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(all_trips[<span class="fu">duplicated</span>(ride_id)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 211</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co">#remove duplicate rides by keeping only the first raw</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>all_trips <span class="ot">&lt;-</span> all_trips[<span class="sc">!</span><span class="fu">duplicated</span>(ride_id)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="data-cleaning-value-consistency-check" class="level1">
<h1>Data cleaning (Value consistency check)</h1>
<p>The member_casual column contains exactly two user types: “member” and “casual”. This matches the dataset description perfectly, so there is no issue with the user type data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(all_trips<span class="sc">$</span>member_casual)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "member" "casual"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co">#convert to factors</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>all_trips<span class="sc">$</span>member_casual <span class="ot">&lt;-</span> <span class="fu">factor</span>(all_trips<span class="sc">$</span>member_casual)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The rideable_type column includes exactly three categories: “classic_bike”, “electric_bike”, and “electric_scooter”. This matches the expected values in the dataset documentation, so the rideable type data is consistent and has no problems.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(all_trips<span class="sc">$</span>rideable_type)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "classic_bike"     "electric_bike"    "electric_scooter"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co">#convert to factors</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>all_trips<span class="sc">$</span>rideable_type <span class="ot">&lt;-</span> <span class="fu">factor</span>(all_trips<span class="sc">$</span>rideable_type)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The started_at and ended_at timestamps for all trips fall within the expected date range of April 2024 to March 2025. No issues were identified with the temporal coverage of the dataset.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define date range</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>start_date <span class="ot">&lt;-</span> <span class="fu">ymd_hms</span>(<span class="st">"2024-04-01 00:00:00"</span>)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>end_date <span class="ot">&lt;-</span> <span class="fu">ymd_hms</span>(<span class="st">"2025-03-31 23:59:59"</span>)</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter wrong records</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>wrong_records <span class="ot">&lt;-</span> all_trips[started_at <span class="sc">&lt;</span> start_date <span class="sc">|</span> </span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>                             started_at <span class="sc">&gt;</span> end_date <span class="sc">|</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>                             ended_at <span class="sc">&lt;</span> start_date <span class="sc">|</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>                             ended_at <span class="sc">&gt;</span> end_date]</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"The number of records out of the date range is </span><span class="sc">\"</span><span class="st">"</span>,<span class="fu">nrow</span>(wrong_records), <span class="st">"</span><span class="sc">\"</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>The number of records out of the date range is " 0 "</code></pre>
</div>
</div>
<p>In the <code>all_trips</code> dataset, some station IDs end with <code>.0</code> due to numeric-to-character conversion. This code removes the <code>.0</code> suffix to standardize formatting and ensure consistent string operations.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>all_trips[, <span class="st">`</span><span class="at">:=</span><span class="st">`</span>(<span class="at">start_station_id =</span> <span class="fu">gsub</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">.0$"</span>, <span class="st">""</span>, start_station_id),</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">end_station_id =</span> <span class="fu">gsub</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">.0$"</span>, <span class="st">""</span>, end_station_id)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>                 )]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In the dataset, each bike station is expected to be assigned a unique ID. However, 111 stations were identified where the same ID was associated with two different names. Additionally, 49 stations were found to have the same name linked to two different IDs.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Get unique station combinations</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>start_unique <span class="ot">&lt;-</span> <span class="fu">unique</span>(all_trips[<span class="sc">!</span><span class="fu">is.na</span>(start_station_id) <span class="sc">&amp;</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>                                   <span class="sc">!</span><span class="fu">is.na</span>(start_station_name),</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>                                 .(<span class="at">station_id =</span> start_station_id, </span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">station_name =</span> start_station_name,</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">lat =</span> start_lat, </span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">lng =</span> start_lng)])</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>end_unique <span class="ot">&lt;-</span> <span class="fu">unique</span>(all_trips[<span class="sc">!</span><span class="fu">is.na</span>(end_station_id) <span class="sc">&amp;</span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>                                 <span class="sc">!</span><span class="fu">is.na</span>(end_station_name),</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>                               .(<span class="at">station_id =</span> end_station_id, </span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>                                <span class="at">station_name =</span> end_station_name,</span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>                                <span class="at">lat =</span> end_lat, </span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>                                <span class="at">lng =</span> end_lng)])</span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>all_station_records <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">rbind</span>(start_unique, end_unique))</span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Find stations with ID conflicts(one Id &amp; multiple names)</span></span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a>id_conflicts_detailed <span class="ot">&lt;-</span> all_station_records[, {</span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a>  name_freq <span class="ot">&lt;-</span> .SD[, .N, by <span class="ot">=</span> station_name]</span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a>  name_freq_str <span class="ot">&lt;-</span> <span class="fu">paste</span>(name_freq<span class="sc">$</span>station_name, <span class="st">"("</span>, name_freq<span class="sc">$</span>N, <span class="st">")"</span>, <span class="at">collapse =</span> <span class="st">", "</span>)</span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">name_frequencies =</span> name_freq_str,</span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a>       <span class="at">most_frequent_name =</span> name_freq[<span class="fu">which.max</span>(N), station_name],</span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a>       <span class="at">name_count =</span> <span class="fu">length</span>(<span class="fu">unique</span>(station_name))</span>
<span id="cb38-25"><a href="#cb38-25" aria-hidden="true" tabindex="-1"></a>       )</span>
<span id="cb38-26"><a href="#cb38-26" aria-hidden="true" tabindex="-1"></a>}, by <span class="ot">=</span> station_id][name_count <span class="sc">&gt;</span> <span class="dv">1</span>]</span>
<span id="cb38-27"><a href="#cb38-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-28"><a href="#cb38-28" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Found"</span>, <span class="fu">nrow</span>(id_conflicts_detailed), <span class="st">"ID conflicts (Stations with one ID &amp; multiple names)"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Found 111 ID conflicts (Stations with one ID &amp; multiple names)"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(id_conflicts_detailed)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     station_id
         &lt;char&gt;
1:          604
2:          515
3: TA1307000113
4:          525
5:          600
6:        13243
                                                                    name_frequencies
                                                                              &lt;char&gt;
1: Sheridan Rd &amp; Noyes St (NU) ( 687 ), Public Rack - Wentworth Ave &amp; 103rd St ( 3 )
2:      Paulina St &amp; Howard St ( 378 ), Public Rack - Hamlin Ave &amp; Chicago Ave ( 5 )
3:    Southport Ave &amp; Wrightwood Ave ( 1655 ), Southport Ave &amp; Wrightwood Ave* ( 4 )
4:  Glenwood Ave &amp; Touhy Ave ( 454 ), Public Rack - Kedzie Ave &amp; Arthington St ( 2 )
5:           Dodge Ave &amp; Church St ( 128 ), Public Rack - Ewing Ave &amp; 112th St ( 1 )
6:        Milwaukee Ave &amp; Wabansia Ave ( 2065 ), Milwaukee Ave &amp; Wabansia Ave* ( 1 )
               most_frequent_name name_count
                           &lt;char&gt;      &lt;int&gt;
1:    Sheridan Rd &amp; Noyes St (NU)          2
2:         Paulina St &amp; Howard St          2
3: Southport Ave &amp; Wrightwood Ave          2
4:       Glenwood Ave &amp; Touhy Ave          2
5:          Dodge Ave &amp; Church St          2
6:   Milwaukee Ave &amp; Wabansia Ave          2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co">#3. Find stations with name conflicts(One name &amp; multiple IDs)</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>name_conflicts_detailed <span class="ot">&lt;-</span> all_station_records[, {</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  id_freq <span class="ot">&lt;-</span> .SD[, .N, by <span class="ot">=</span> station_id]</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>  id_freq_str <span class="ot">&lt;-</span> <span class="fu">paste</span>(id_freq<span class="sc">$</span>station_id, <span class="st">"("</span>, id_freq<span class="sc">$</span>N, <span class="st">")"</span>, <span class="at">collapse =</span> <span class="st">", "</span>)</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">id_frequencies =</span> id_freq_str,</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">most_frequent_id =</span> id_freq[<span class="fu">which.max</span>(N), station_id],</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">id_count =</span> <span class="fu">length</span>(<span class="fu">unique</span>(station_id)))</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>}, by <span class="ot">=</span> station_name][id_count <span class="sc">&gt;</span> <span class="dv">1</span>]</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Found"</span>, <span class="fu">nrow</span>(name_conflicts_detailed), <span class="st">"name conflicts (Stations with one name &amp; multiple IDs)"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Found 49 name conflicts (Stations with one name &amp; multiple IDs)"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(name_conflicts_detailed)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                    station_name                      id_frequencies
                          &lt;char&gt;                              &lt;char&gt;
1:        Halsted St &amp; Roscoe St TA1309000025 ( 3680 ), 13127 ( 68 )
2: Sheffield Ave &amp; Fullerton Ave  TA1306000016 ( 3116 ), 13060 ( 3 )
3:      Racine Ave &amp; Belmont Ave  TA1308000019 ( 2016 ), 13230 ( 3 )
4:          Kedzie Ave &amp; 52nd St             384 ( 7 ), 21384 ( 26 )
5:        St Louis Ave &amp; 59th St             21387 ( 44 ), 387 ( 3 )
6:    Burling St &amp; Diversey Pkwy TA1309000036 ( 1553 ), 13208 ( 13 )
   most_frequent_id id_count
             &lt;char&gt;    &lt;int&gt;
1:     TA1309000025        2
2:     TA1306000016        2
3:     TA1308000019        2
4:            21384        2
5:            21387        2
6:     TA1309000036        2</code></pre>
</div>
</div>
<p>This issue could impact a significant number of bike rides. A total of 638,153 trips were affected by station ID conflicts, while 163,410 trips were impacted by name conflicts. In total, 723084 trips were found to be affected by these inconsistencies, representing approximately 12.51% of all recorded trips.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Count trips affected by ID conflicts</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>id_conflict_stations <span class="ot">&lt;-</span> id_conflicts_detailed<span class="sc">$</span>station_id</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>trips_with_id_conflicts <span class="ot">&lt;-</span> <span class="fu">sum</span>(</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>  all_trips<span class="sc">$</span>start_station_id <span class="sc">%in%</span> id_conflict_stations <span class="sc">|</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>  all_trips<span class="sc">$</span>end_station_id <span class="sc">%in%</span> id_conflict_stations</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Count trips affected by name conflicts  </span></span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>name_conflict_names <span class="ot">&lt;-</span> name_conflicts_detailed<span class="sc">$</span>station_name</span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>trips_with_name_conflicts <span class="ot">&lt;-</span> <span class="fu">sum</span>(</span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>  all_trips<span class="sc">$</span>start_station_name <span class="sc">%in%</span> name_conflict_names <span class="sc">|</span></span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>  all_trips<span class="sc">$</span>end_station_name <span class="sc">%in%</span> name_conflict_names</span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Total affected trips (some may overlap)</span></span>
<span id="cb46-18"><a href="#cb46-18" aria-hidden="true" tabindex="-1"></a>total_affected <span class="ot">&lt;-</span> <span class="fu">sum</span>(</span>
<span id="cb46-19"><a href="#cb46-19" aria-hidden="true" tabindex="-1"></a>  all_trips<span class="sc">$</span>start_station_id <span class="sc">%in%</span> id_conflict_stations <span class="sc">|</span></span>
<span id="cb46-20"><a href="#cb46-20" aria-hidden="true" tabindex="-1"></a>  all_trips<span class="sc">$</span>end_station_id <span class="sc">%in%</span> id_conflict_stations <span class="sc">|</span></span>
<span id="cb46-21"><a href="#cb46-21" aria-hidden="true" tabindex="-1"></a>  all_trips<span class="sc">$</span>start_station_name <span class="sc">%in%</span> name_conflict_names <span class="sc">|</span></span>
<span id="cb46-22"><a href="#cb46-22" aria-hidden="true" tabindex="-1"></a>  all_trips<span class="sc">$</span>end_station_name <span class="sc">%in%</span> name_conflict_names</span>
<span id="cb46-23"><a href="#cb46-23" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb46-24"><a href="#cb46-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-25"><a href="#cb46-25" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Trips affected by ID conflicts:"</span>, trips_with_id_conflicts))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Trips affected by ID conflicts: 638153"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Trips affected by name conflicts:"</span>, trips_with_name_conflicts))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Trips affected by name conflicts: 163410"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Total trips affected:"</span>, total_affected))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Total trips affected: 723084"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Percentage affected:"</span>, <span class="fu">round</span>(total_affected<span class="sc">/</span><span class="fu">nrow</span>(all_trips)<span class="sc">*</span><span class="dv">100</span>, <span class="dv">2</span>), <span class="st">"%"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Percentage affected: 12.51 %"</code></pre>
</div>
</div>
<p>To resolve these inconsistencies, we retain the most frequent station name for ID conflicts and the most frequent ID for name conflicts. Since the conflicting names are often entirely different rather than minor variations, and using coordinates for resolution would be resource-intensive, selecting the most commonly occurring values is a practical approach given the dataset size and observed patterns.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Resolve ID conflicts - keep most frequent name, mean coordinates without outliers</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>resolved_id_conflicts <span class="ot">&lt;-</span> id_conflicts_detailed[, </span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>    .(<span class="at">station_name =</span> most_frequent_name),</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>    by <span class="ot">=</span> station_id]</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Resolve name conflicts - keep most frequent ID</span></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>resolved_name_conflicts <span class="ot">&lt;-</span> name_conflicts_detailed[, </span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>    .(<span class="at">final_station_id =</span> most_frequent_id),</span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>    by <span class="ot">=</span> station_name]</span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Resolved"</span>, <span class="fu">nrow</span>(resolved_id_conflicts), <span class="st">"ID conflicts"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Resolved 111 ID conflicts"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Resolved"</span>, <span class="fu">nrow</span>(resolved_name_conflicts), <span class="st">"name conflicts"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Resolved 49 name conflicts"</code></pre>
</div>
</div>
<p>We will update the <code>all_station_records</code> dataset by applying conflict resolutions and consolidating coordinates. Since there was some small noise in the coordinate data, we’ll average the latitude and longitude values for each station to ensure that each station name has a single, representative coordinate pair. This process will eliminate duplicate entries and provide a clean, unified station dataset.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply ID conflict resolutions to all_station_records</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>all_station_records[resolved_id_conflicts, on <span class="ot">=</span> <span class="st">"station_id"</span>,</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>             <span class="st">`</span><span class="at">:=</span><span class="st">`</span>(<span class="at">station_name =</span> i.station_name)]</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply name conflict resolutions to all_station_records</span></span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>all_station_records[resolved_name_conflicts, on <span class="ot">=</span> <span class="st">"station_name"</span>,</span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>             station_id <span class="sc">:</span><span class="er">=</span> i.final_station_id]</span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Consolidate coordinates (one coordinate per station)</span></span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a>all_station_records[,<span class="st">`</span><span class="at">:=</span><span class="st">`</span>(<span class="at">lat =</span> <span class="fu">mean</span>(lat), <span class="at">lng =</span> <span class="fu">mean</span>(lng)),</span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a>                    by <span class="ot">=</span> .(station_id, station_name)]</span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Keep only unique stations "now we have all unique stations without any conflicts"</span></span>
<span id="cb58-14"><a href="#cb58-14" aria-hidden="true" tabindex="-1"></a>all_station_records <span class="ot">&lt;-</span> <span class="fu">unique</span>(all_station_records)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We now update the <code>all_trips</code> dataset to ensure consistency by applying the resolved station names, IDs, and consolidated coordinates to eliminate coordinate noise across all trip records.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply the changes to the all_trips dataset </span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>all_trips[all_station_records, on <span class="ot">=</span> <span class="st">"start_station_id==station_id"</span>,</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>             <span class="st">`</span><span class="at">:=</span><span class="st">`</span>(<span class="at">start_station_name =</span> i.station_name)]</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>all_trips[all_station_records, on <span class="ot">=</span> <span class="st">"end_station_id==station_id"</span>,</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>             <span class="st">`</span><span class="at">:=</span><span class="st">`</span>(<span class="at">end_station_name =</span> i.station_name)]</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>all_trips[all_station_records, on <span class="ot">=</span> <span class="st">"start_station_name==station_name"</span>,</span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>             <span class="st">`</span><span class="at">:=</span><span class="st">`</span>(<span class="at">start_station_id =</span> i.station_id)]</span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a>all_trips[all_station_records, on <span class="ot">=</span> <span class="st">"end_station_name==station_name"</span>,</span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a>             <span class="st">`</span><span class="at">:=</span><span class="st">`</span>(<span class="at">end_station_id =</span> i.station_id)]</span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a>all_trips[all_station_records, on <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"start_station_id==station_id"</span>, <span class="st">"start_station_name==station_name"</span>),</span>
<span id="cb59-15"><a href="#cb59-15" aria-hidden="true" tabindex="-1"></a>             <span class="st">`</span><span class="at">:=</span><span class="st">`</span>(<span class="at">start_lat =</span> i.lat, <span class="at">start_lng =</span> i.lng)]</span>
<span id="cb59-16"><a href="#cb59-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-17"><a href="#cb59-17" aria-hidden="true" tabindex="-1"></a>all_trips[all_station_records, on <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"end_station_id==station_id"</span>, <span class="st">"end_station_name==station_name"</span>),</span>
<span id="cb59-18"><a href="#cb59-18" aria-hidden="true" tabindex="-1"></a>             <span class="st">`</span><span class="at">:=</span><span class="st">`</span>(<span class="at">end_lat =</span> i.lat, <span class="at">end_lng =</span> i.lng)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="data-transformationadd-ride-duration-column-data-cleaningdelete-ride-duration-outliers" class="level1">
<h1>Data transformation(add ride duration column) &amp; Data cleaning(delete ride duration outliers)</h1>
<p>A new column ride_duration was created to measure the length of each trip. Rows with negative ride durations, which are likely due to data entry errors or system glitches, were identified and removed from the dataset.<br>
</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>all_trips <span class="ot">&lt;-</span> all_trips[, ride_duration <span class="sc">:</span><span class="er">=</span> <span class="fu">as.numeric</span>(<span class="fu">difftime</span>(ended_at,</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>                                                 started_at,</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>                                                 <span class="at">units =</span> <span class="st">"secs"</span>)</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>                                        )][ride_duration <span class="sc">&gt;</span> <span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The ride_duration variable ranges from 0.04 seconds to almost 26 hours (93595 seconds). The median ride duration is approximately 579 seconds (about 9.6 minutes), while the mean is higher at 921 seconds (about 15.3 minutes), indicating a right-skewed distribution likely influenced by a small number of very long rides.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(all_trips<span class="sc">$</span>ride_duration)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Min.   1st Qu.    Median      Mean   3rd Qu.      Max. 
    0.039   330.566   579.988  1021.758  1030.000 93595.072 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co">#see upper and lower outliers</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort in descending order to see highest values first</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>all_trips_sorted <span class="ot">&lt;-</span> all_trips[<span class="fu">order</span>(all_trips<span class="sc">$</span>ride_duration, <span class="at">decreasing =</span> <span class="cn">TRUE</span>)]</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a><span class="co"># View the top records (potential upper outliers)</span></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(all_trips_sorted<span class="sc">$</span>ride_duration, <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 93595.07 93594.87 93594.59 93591.38 93590.98 93579.58 93579.52 93578.54
 [9] 93578.33 90051.76</code></pre>
</div>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(all_trips_sorted<span class="sc">$</span>ride_duration, <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 0.10399985 0.10300016 0.09300017 0.08999991 0.06999993 0.06599998
 [7] 0.06599998 0.05099988 0.04200006 0.03899980</code></pre>
</div>
</div>
<p>Based on industry standards and best practices, rides with a duration of less than 1 minute or greater than 24 hours were considered outliers or unrealistic entries. These were likely due to user errors, system issues, or abnormal usage. Therefore, these records were filtered out to improve the accuracy and reliability of the analysis.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>extreme_rides <span class="ot">&lt;-</span> all_trips[ride_duration <span class="sc">&lt;</span> <span class="dv">60</span> <span class="sc">|</span> ride_duration <span class="sc">&gt;</span> <span class="dv">86400</span>]</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(extreme_rides)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 135098</code></pre>
</div>
</div>
<p>Although 135,098 outliers were removed from a total of 5,779,568 records, this represents only 2.33% of the data and is considered acceptable.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co"># remove records that have ride durations less than 1 min and more than 24h</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>all_trips <span class="ot">&lt;-</span> all_trips[ride_duration <span class="sc">&gt;=</span> <span class="dv">60</span> <span class="sc">&amp;</span> ride_duration <span class="sc">&lt;=</span> <span class="dv">86400</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>After removing extreme durations, the ride_duration distribution remained right-skewed. A visualization was created to better understand the spread, and based on the plot, a threshold for outliers was determined to further clean the data. This helped in identifying and removing unusually long rides that could distort the analysis.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(all_trips<span class="sc">$</span>ride_duration)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
   60.0   344.8   592.8   937.0  1043.5 86396.1 </code></pre>
</div>
</div>
<p>A quantile plot of ride durations was created to visualize the distribution and detect potential outliers. Extreme values were observed around the 99th percentile, indicating the presence of unusually long rides that could impact the analysis.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co"># quantile plot - show exact percentiles</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>main_color <span class="ot">&lt;-</span> <span class="st">"steelblue"</span></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>highlight_color <span class="ot">&lt;-</span> <span class="st">"tomato"</span></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate percentiles at regular intervals</span></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>probs <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.01</span>)</span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>quantiles <span class="ot">&lt;-</span> <span class="fu">quantile</span>(all_trips<span class="sc">$</span>ride_duration<span class="sc">/</span><span class="dv">60</span>, <span class="at">probs =</span> probs)</span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>df_quantiles <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">percentile =</span> probs <span class="sc">*</span> <span class="dv">100</span>, <span class="at">duration =</span> quantiles)</span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df_quantiles, <span class="fu">aes</span>(<span class="at">x =</span> percentile, <span class="at">y =</span> duration)) <span class="sc">+</span></span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> main_color, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> main_color, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Quantile Plot of Ride Durations"</span>,</span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Shows duration at each percentile"</span>,</span>
<span id="cb72-14"><a href="#cb72-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Percentile"</span>,</span>
<span id="cb72-15"><a href="#cb72-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Duration (minutes)"</span>) <span class="sc">+</span></span>
<span id="cb72-16"><a href="#cb72-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb72-17"><a href="#cb72-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb72-18"><a href="#cb72-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
ℹ Please use `linewidth` instead.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="case_study_bikes_v1_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br>
The lower and upper thresholds were plotted on the distribution graph to improve the visualization and understanding of potential outliers. This was done to support decision-making, as no additional input was available beyond the 24-hour and 60-second industry limits that had already been applied earlier.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Shows our recommended cutoffs</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a dataset with cleaning thresholds</span></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>lower_bound <span class="ot">&lt;-</span> <span class="dv">60</span>  <span class="co"># 1 minute</span></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>upper_bound <span class="ot">&lt;-</span> <span class="fu">quantile</span>(all_trips<span class="sc">$</span>ride_duration, <span class="fl">0.99</span>)  <span class="co"># 99th percentile</span></span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(all_trips, <span class="fu">aes</span>(<span class="at">x =</span> ride_duration<span class="sc">/</span><span class="dv">60</span>)) <span class="sc">+</span></span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">100</span>, <span class="at">fill =</span> main_color, <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">position =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> lower_bound<span class="sc">/</span><span class="dv">60</span>, <span class="at">color =</span> highlight_color, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> upper_bound<span class="sc">/</span><span class="dv">60</span>, <span class="at">color =</span> highlight_color, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>() <span class="sc">+</span></span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">comma_format</span>()) <span class="sc">+</span> </span>
<span id="cb75-12"><a href="#cb75-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> lower_bound<span class="sc">/</span><span class="dv">60</span>, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">label =</span> <span class="st">"Lower Threshold"</span>, </span>
<span id="cb75-13"><a href="#cb75-13" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> highlight_color, <span class="at">angle =</span> <span class="dv">90</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span>, <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb75-14"><a href="#cb75-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> upper_bound<span class="sc">/</span><span class="dv">60</span>, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">label =</span> <span class="st">"Upper Threshold"</span>, </span>
<span id="cb75-15"><a href="#cb75-15" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> highlight_color, <span class="at">angle =</span> <span class="dv">90</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span>, <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb75-16"><a href="#cb75-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Distribution with Cleaning Thresholds"</span>,</span>
<span id="cb75-17"><a href="#cb75-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="fu">paste0</span>(<span class="st">"Lower: "</span>, <span class="fu">round</span>(lower_bound<span class="sc">/</span><span class="dv">60</span>, <span class="dv">1</span>), <span class="st">" min | Upper: "</span>, <span class="fu">round</span>(upper_bound<span class="sc">/</span><span class="dv">60</span>, <span class="dv">1</span>), <span class="st">" min"</span>),</span>
<span id="cb75-18"><a href="#cb75-18" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Duration (minutes, log scale)"</span>,</span>
<span id="cb75-19"><a href="#cb75-19" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Count"</span>) <span class="sc">+</span></span>
<span id="cb75-20"><a href="#cb75-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb75-21"><a href="#cb75-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb75-22"><a href="#cb75-22" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb75-23"><a href="#cb75-23" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="case_study_bikes_v1_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The initial visualization of ride duration with outlier thresholds looked acceptable. However, a second plot showing ride duration distribution by rider type (members vs.&nbsp;casuals) revealed that the upper threshold at the 99th percentile was too restrictive, especially for casual users. As a result, the upper limit was adjusted to the 99.80th percentile, while the lower threshold remained at 60 seconds. This adjustment provided a more accurate representation of typical ride durations across both user groups.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Shows our recommended cutoffs</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a dataset with cleaning thresholds</span></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>lower_bound <span class="ot">&lt;-</span> <span class="dv">60</span>  <span class="co"># 1 minute</span></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>upper_bound <span class="ot">&lt;-</span> <span class="fu">quantile</span>(all_trips<span class="sc">$</span>ride_duration, <span class="fl">0.99</span>)  <span class="co"># 99th percentile</span></span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(all_trips, <span class="fu">aes</span>(<span class="at">x =</span> ride_duration<span class="sc">/</span><span class="dv">60</span>, <span class="at">fill =</span> member_casual)) <span class="sc">+</span></span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">100</span>, <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">position =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> lower_bound<span class="sc">/</span><span class="dv">60</span>, <span class="at">color =</span> highlight_color, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> upper_bound<span class="sc">/</span><span class="dv">60</span>, <span class="at">color =</span> highlight_color, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>() <span class="sc">+</span></span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">comma_format</span>()) <span class="sc">+</span> </span>
<span id="cb76-12"><a href="#cb76-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> lower_bound<span class="sc">/</span><span class="dv">60</span>, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">label =</span> <span class="st">"Lower Threshold"</span>, </span>
<span id="cb76-13"><a href="#cb76-13" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> highlight_color, <span class="at">angle =</span> <span class="dv">90</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span>, <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb76-14"><a href="#cb76-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> upper_bound<span class="sc">/</span><span class="dv">60</span>, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">label =</span> <span class="st">"Upper Threshold"</span>, </span>
<span id="cb76-15"><a href="#cb76-15" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> highlight_color, <span class="at">angle =</span> <span class="dv">90</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span>, <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb76-16"><a href="#cb76-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Distribution with Cleaning Thresholds"</span>,</span>
<span id="cb76-17"><a href="#cb76-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="fu">paste0</span>(<span class="st">"Lower: "</span>, <span class="fu">round</span>(lower_bound<span class="sc">/</span><span class="dv">60</span>, <span class="dv">1</span>), <span class="st">" min | Upper: "</span>, <span class="fu">round</span>(upper_bound<span class="sc">/</span><span class="dv">60</span>, <span class="dv">1</span>), <span class="st">" min"</span>),</span>
<span id="cb76-18"><a href="#cb76-18" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Duration (minutes, log scale)"</span>,</span>
<span id="cb76-19"><a href="#cb76-19" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Count"</span>) <span class="sc">+</span></span>
<span id="cb76-20"><a href="#cb76-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb76-21"><a href="#cb76-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb76-22"><a href="#cb76-22" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb76-23"><a href="#cb76-23" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb76-24"><a href="#cb76-24" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="case_study_bikes_v1_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The lower bound was set at 60 seconds, and the upper bound at approximately 194.8 minutes (based on the 99.80th percentile). This range better captures typical ride durations for both members and casual riders, while effectively excluding unrealistic outliers.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Shows our recommended cutoffs</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a dataset with cleaning thresholds</span></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>lower_bound <span class="ot">&lt;-</span> <span class="dv">60</span>  <span class="co"># 1 minute</span></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>upper_bound <span class="ot">&lt;-</span> <span class="fu">quantile</span>(all_trips<span class="sc">$</span>ride_duration, <span class="fl">0.9980</span>)  <span class="co"># 99th percentile</span></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(all_trips, <span class="fu">aes</span>(<span class="at">x =</span> ride_duration<span class="sc">/</span><span class="dv">60</span>, <span class="at">fill =</span> member_casual)) <span class="sc">+</span></span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">100</span>, <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">position =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> lower_bound<span class="sc">/</span><span class="dv">60</span>, <span class="at">color =</span> highlight_color, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> upper_bound<span class="sc">/</span><span class="dv">60</span>, <span class="at">color =</span> highlight_color, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>() <span class="sc">+</span></span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">comma_format</span>()) <span class="sc">+</span> </span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> lower_bound<span class="sc">/</span><span class="dv">60</span>, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">label =</span> <span class="st">"Lower Threshold"</span>, </span>
<span id="cb77-13"><a href="#cb77-13" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> highlight_color, <span class="at">angle =</span> <span class="dv">90</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span>, <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb77-14"><a href="#cb77-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> upper_bound<span class="sc">/</span><span class="dv">60</span>, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">label =</span> <span class="st">"Upper Threshold"</span>, </span>
<span id="cb77-15"><a href="#cb77-15" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> highlight_color, <span class="at">angle =</span> <span class="dv">90</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span>, <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb77-16"><a href="#cb77-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Distribution with Cleaning Thresholds"</span>,</span>
<span id="cb77-17"><a href="#cb77-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="fu">paste0</span>(<span class="st">"Lower: "</span>, <span class="fu">round</span>(lower_bound<span class="sc">/</span><span class="dv">60</span>, <span class="dv">1</span>), <span class="st">" min | Upper: "</span>, <span class="fu">round</span>(upper_bound<span class="sc">/</span><span class="dv">60</span>, <span class="dv">1</span>), <span class="st">" min"</span>),</span>
<span id="cb77-18"><a href="#cb77-18" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Duration (minutes, log scale)"</span>,</span>
<span id="cb77-19"><a href="#cb77-19" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Count"</span>) <span class="sc">+</span></span>
<span id="cb77-20"><a href="#cb77-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb77-21"><a href="#cb77-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb77-22"><a href="#cb77-22" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb77-23"><a href="#cb77-23" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb77-24"><a href="#cb77-24" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="case_study_bikes_v1_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Rides longer than 194.8 minutes were added the extreme rides dataset for potential analysis then removed from the all_trips dataset, as they represent only 11,290 records out of a total of 5,643,748 (0.2%). This decision helps eliminate outliers and ensures the analysis focuses on typical ride durations.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Identify rides that exceed the threshold (will be removed)</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>rides_to_remove <span class="ot">&lt;-</span> all_trips[all_trips<span class="sc">$</span>ride_duration <span class="sc">&gt;</span> <span class="fl">194.8</span><span class="sc">*</span><span class="dv">60</span>]</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Add these rides to the existing extreme_rides dataset</span></span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>extreme_rides <span class="ot">&lt;-</span> <span class="fu">rbind</span>(extreme_rides, rides_to_remove)</span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Now remove the extreme rides from all_trips</span></span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a>all_trips <span class="ot">&lt;-</span> all_trips[ride_duration <span class="sc">&lt;=</span> <span class="fl">194.8</span><span class="sc">*</span><span class="dv">60</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="data-transformation-day_of_week-hour_of_day-month-part_of_day-is_weekend" class="level1">
<h1>Data transformation (day_of_week, hour_of_day, month, part_of_day, is_weekend)</h1>
<p>Several new columns were added to enrich the dataset and support deeper analysis:</p>
<p>-<strong>day_of_week</strong>: day the ride started (e.g., Monday, Tuesday)</p>
<p>-<strong>hour_of_day</strong>: hour the ride began (0–23)</p>
<p>-<strong>month</strong>: month of the ride (e.g., January, February)</p>
<p>-<strong>part_of_day</strong>: time segment of the ride (e.g., morning, afternoon, evening, night)</p>
<p>-<strong>is_weekend</strong>: flag indicating whether the ride occurred on a weekend (TRUE/FALSE)</p>
<p>These features help analyze temporal patterns, user behavior, and ride characteristics more effectively.</p>
<p><em>(note: The total distance can indeed be calculated using the coordinates of the start and end stations, typically by calculating the straight-line (great-circle) distance between the two points. However, I’ve chosen not to rely on this measure for the analysis.</em></p>
<p><em>I believe that the total distance of the trip will not add much value to the analysis. Since bike trips are not necessarily linear, a rider could take a long route and still return to the same station, resulting in a calculated distance of zero. This would misrepresent the actual effort or nature of the trip.)</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This prepares the dataset with additional variables for analysis</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>all_trips[, <span class="st">`</span><span class="at">:=</span><span class="st">`</span> (<span class="at">day_of_week =</span> </span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">factor</span>(<span class="fu">wday</span>(started_at),</span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>                           <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>,</span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>                           <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Sun"</span>, <span class="st">"Mon"</span>, <span class="st">"Tue"</span>, <span class="st">"Wed"</span>,</span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"Thu"</span>, <span class="st">"Fri"</span>, <span class="st">"Sat"</span>)),</span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a>                  <span class="at">hour_of_day =</span> <span class="fu">hour</span>(started_at),</span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a>                  </span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a>                  <span class="co"># Extract month as number, then convert to labels</span></span>
<span id="cb79-10"><a href="#cb79-10" aria-hidden="true" tabindex="-1"></a>                  <span class="at">month =</span> <span class="fu">factor</span>(<span class="fu">month</span>(started_at),</span>
<span id="cb79-11"><a href="#cb79-11" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>,</span>
<span id="cb79-12"><a href="#cb79-12" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Jan"</span>, <span class="st">"Feb"</span>, <span class="st">"Mar"</span>, <span class="st">"Apr"</span>, <span class="st">"May"</span>,</span>
<span id="cb79-13"><a href="#cb79-13" aria-hidden="true" tabindex="-1"></a>                                            <span class="st">"Jun"</span>, <span class="st">"Jul"</span>, <span class="st">"Aug"</span>, <span class="st">"Sep"</span>, <span class="st">"Oct"</span>,</span>
<span id="cb79-14"><a href="#cb79-14" aria-hidden="true" tabindex="-1"></a>                                            <span class="st">"Nov"</span>, <span class="st">"Dec"</span>)),</span>
<span id="cb79-15"><a href="#cb79-15" aria-hidden="true" tabindex="-1"></a>                  </span>
<span id="cb79-16"><a href="#cb79-16" aria-hidden="true" tabindex="-1"></a>                  <span class="co"># Create weekend/weekday flag</span></span>
<span id="cb79-17"><a href="#cb79-17" aria-hidden="true" tabindex="-1"></a>                  <span class="at">is_weekend =</span> <span class="fu">if_else</span>(<span class="fu">wday</span>(started_at) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">7</span>),</span>
<span id="cb79-18"><a href="#cb79-18" aria-hidden="true" tabindex="-1"></a>                                       <span class="st">"Weekend"</span>, <span class="st">"Weekday"</span>)</span>
<span id="cb79-19"><a href="#cb79-19" aria-hidden="true" tabindex="-1"></a>                  )]</span>
<span id="cb79-20"><a href="#cb79-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-21"><a href="#cb79-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Group hours into parts of day</span></span>
<span id="cb79-22"><a href="#cb79-22" aria-hidden="true" tabindex="-1"></a>all_trips[, parts_ofday <span class="sc">:</span><span class="er">=</span> <span class="fu">case_when</span>(</span>
<span id="cb79-23"><a href="#cb79-23" aria-hidden="true" tabindex="-1"></a>  hour_of_day <span class="sc">&gt;=</span> <span class="dv">5</span> <span class="sc">&amp;</span> hour_of_day <span class="sc">&lt;</span> <span class="dv">12</span> <span class="sc">~</span> <span class="st">"Morning"</span>,</span>
<span id="cb79-24"><a href="#cb79-24" aria-hidden="true" tabindex="-1"></a>  hour_of_day <span class="sc">&gt;=</span> <span class="dv">12</span> <span class="sc">&amp;</span> hour_of_day <span class="sc">&lt;</span> <span class="dv">17</span> <span class="sc">~</span> <span class="st">"Afternoon"</span>,</span>
<span id="cb79-25"><a href="#cb79-25" aria-hidden="true" tabindex="-1"></a>  hour_of_day <span class="sc">&gt;=</span> <span class="dv">17</span> <span class="sc">&amp;</span> hour_of_day <span class="sc">&lt;</span> <span class="dv">21</span> <span class="sc">~</span> <span class="st">"Evening"</span>,</span>
<span id="cb79-26"><a href="#cb79-26" aria-hidden="true" tabindex="-1"></a>  <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Night"</span></span>
<span id="cb79-27"><a href="#cb79-27" aria-hidden="true" tabindex="-1"></a>  )]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="data-transformation-adding-neighborhoods" class="level1">
<h1>Data transformation (Adding neighborhoods)</h1>
<p>Two new columns, PRI_NEIGH (primary neighborhood) and SEC_NEIGH (secondary neighborhood), were added by mapping station coordinates to their corresponding neighborhoods. This enrichment enables geographic analysis of ride patterns across different areas of the city, even when station names are missing. Neighborhood information was added to the dataset using <em>Neighborhoods_2012b.csv</em>, which defines approximate neighborhood boundaries in Chicago, developed by the Office of Tourism.The data is also available on the Chicago Data Portal.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to read and convert neighborhoods to spatial object</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>read_neighborhoods <span class="ot">&lt;-</span> <span class="cf">function</span>(file_path) {</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Read the CSV</span></span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>  neighborhoods_df <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(file_path)</span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Try to convert to spatial object</span></span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tryCatch</span>({</span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a>    neighborhoods_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(neighborhoods_df, <span class="at">wkt =</span> <span class="st">"the_geom"</span>, <span class="at">crs =</span> <span class="dv">4326</span>)</span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Verify the spatial object</span></span>
<span id="cb80-11"><a href="#cb80-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">#cat("\nSpatial Object Information:\n")</span></span>
<span id="cb80-12"><a href="#cb80-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">#print(st_crs(neighborhoods_sf))</span></span>
<span id="cb80-13"><a href="#cb80-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">#print(st_geometry_type(neighborhoods_sf) |&gt;  table())</span></span>
<span id="cb80-14"><a href="#cb80-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb80-15"><a href="#cb80-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(neighborhoods_sf)</span>
<span id="cb80-16"><a href="#cb80-16" aria-hidden="true" tabindex="-1"></a>  }, <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb80-17"><a href="#cb80-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Error converting to spatial object:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb80-18"><a href="#cb80-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(e)</span>
<span id="cb80-19"><a href="#cb80-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(e)</span>
<span id="cb80-20"><a href="#cb80-20" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb80-21"><a href="#cb80-21" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb80-22"><a href="#cb80-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-23"><a href="#cb80-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to process dataset with neighborhood labeling</span></span>
<span id="cb80-24"><a href="#cb80-24" aria-hidden="true" tabindex="-1"></a>process_bike_trips_neighborhoods <span class="ot">&lt;-</span> <span class="cf">function</span>(trips_data, neighborhoods_sf) {</span>
<span id="cb80-25"><a href="#cb80-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Filter out records with missing coordinates</span></span>
<span id="cb80-26"><a href="#cb80-26" aria-hidden="true" tabindex="-1"></a>  trips_clean <span class="ot">&lt;-</span> trips_data[<span class="sc">!</span><span class="fu">is.na</span>(start_lng) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(start_lat) <span class="sc">&amp;</span></span>
<span id="cb80-27"><a href="#cb80-27" aria-hidden="true" tabindex="-1"></a>                               <span class="sc">!</span><span class="fu">is.na</span>(end_lng) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(end_lat)]</span>
<span id="cb80-28"><a href="#cb80-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-29"><a href="#cb80-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convert trips data to spatial points</span></span>
<span id="cb80-30"><a href="#cb80-30" aria-hidden="true" tabindex="-1"></a>  trips_start <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(trips_clean, </span>
<span id="cb80-31"><a href="#cb80-31" aria-hidden="true" tabindex="-1"></a>                           <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"start_lng"</span>, <span class="st">"start_lat"</span>), </span>
<span id="cb80-32"><a href="#cb80-32" aria-hidden="true" tabindex="-1"></a>                           <span class="at">crs =</span> <span class="fu">st_crs</span>(neighborhoods_sf))</span>
<span id="cb80-33"><a href="#cb80-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb80-34"><a href="#cb80-34" aria-hidden="true" tabindex="-1"></a>  trips_end <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(trips_clean, </span>
<span id="cb80-35"><a href="#cb80-35" aria-hidden="true" tabindex="-1"></a>                        <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"end_lng"</span>, <span class="st">"end_lat"</span>), </span>
<span id="cb80-36"><a href="#cb80-36" aria-hidden="true" tabindex="-1"></a>                        <span class="at">crs =</span> <span class="fu">st_crs</span>(neighborhoods_sf))</span>
<span id="cb80-37"><a href="#cb80-37" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb80-38"><a href="#cb80-38" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Spatial join for start neighborhoods</span></span>
<span id="cb80-39"><a href="#cb80-39" aria-hidden="true" tabindex="-1"></a>  start_neighborhoods <span class="ot">&lt;-</span> <span class="fu">st_join</span>(trips_start, </span>
<span id="cb80-40"><a href="#cb80-40" aria-hidden="true" tabindex="-1"></a>                                 neighborhoods_sf[,<span class="fu">c</span>(<span class="st">"PRI_NEIGH"</span>, <span class="st">"SEC_NEIGH"</span>)], </span>
<span id="cb80-41"><a href="#cb80-41" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">join =</span> st_within)</span>
<span id="cb80-42"><a href="#cb80-42" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb80-43"><a href="#cb80-43" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Spatial join for end neighborhoods</span></span>
<span id="cb80-44"><a href="#cb80-44" aria-hidden="true" tabindex="-1"></a>  end_neighborhoods <span class="ot">&lt;-</span> <span class="fu">st_join</span>(trips_end, </span>
<span id="cb80-45"><a href="#cb80-45" aria-hidden="true" tabindex="-1"></a>                               neighborhoods_sf[,<span class="fu">c</span>(<span class="st">"PRI_NEIGH"</span>, <span class="st">"SEC_NEIGH"</span>)], </span>
<span id="cb80-46"><a href="#cb80-46" aria-hidden="true" tabindex="-1"></a>                               <span class="at">join =</span> st_within)</span>
<span id="cb80-47"><a href="#cb80-47" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb80-48"><a href="#cb80-48" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Combine results</span></span>
<span id="cb80-49"><a href="#cb80-49" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> trips_clean[, <span class="st">`</span><span class="at">:=</span><span class="st">`</span> </span>
<span id="cb80-50"><a href="#cb80-50" aria-hidden="true" tabindex="-1"></a>     (<span class="at">start_primary_neighborhood =</span> start_neighborhoods<span class="sc">$</span>PRI_NEIGH,</span>
<span id="cb80-51"><a href="#cb80-51" aria-hidden="true" tabindex="-1"></a>      <span class="at">start_secondary_neighborhood =</span> start_neighborhoods<span class="sc">$</span>SEC_NEIGH,</span>
<span id="cb80-52"><a href="#cb80-52" aria-hidden="true" tabindex="-1"></a>      <span class="at">end_primary_neighborhood =</span> end_neighborhoods<span class="sc">$</span>PRI_NEIGH,</span>
<span id="cb80-53"><a href="#cb80-53" aria-hidden="true" tabindex="-1"></a>      <span class="at">end_secondary_neighborhood =</span> end_neighborhoods<span class="sc">$</span>SEC_NEIGH)]</span>
<span id="cb80-54"><a href="#cb80-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-55"><a href="#cb80-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(result)</span>
<span id="cb80-56"><a href="#cb80-56" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb80-57"><a href="#cb80-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-58"><a href="#cb80-58" aria-hidden="true" tabindex="-1"></a><span class="co"># Main processing function</span></span>
<span id="cb80-59"><a href="#cb80-59" aria-hidden="true" tabindex="-1"></a>add_neighborhoods_to_trips <span class="ot">&lt;-</span> <span class="cf">function</span>(trips_data, neighborhoods_sf) {</span>
<span id="cb80-60"><a href="#cb80-60" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Process neighborhoods</span></span>
<span id="cb80-61"><a href="#cb80-61" aria-hidden="true" tabindex="-1"></a>  trips_with_neighborhoods <span class="ot">&lt;-</span> <span class="fu">process_bike_trips_neighborhoods</span>(trips_data,</span>
<span id="cb80-62"><a href="#cb80-62" aria-hidden="true" tabindex="-1"></a>                                                               neighborhoods_sf)</span>
<span id="cb80-63"><a href="#cb80-63" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb80-64"><a href="#cb80-64" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Summary statistics</span></span>
<span id="cb80-65"><a href="#cb80-65" aria-hidden="true" tabindex="-1"></a>  <span class="co">#cat("Neighborhood Labeling Summary:\n")</span></span>
<span id="cb80-66"><a href="#cb80-66" aria-hidden="true" tabindex="-1"></a>  <span class="co">#cat("Total records:", nrow(trips_with_neighborhoods), "\n\n")</span></span>
<span id="cb80-67"><a href="#cb80-67" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb80-68"><a href="#cb80-68" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Neighborhood distribution</span></span>
<span id="cb80-69"><a href="#cb80-69" aria-hidden="true" tabindex="-1"></a>  <span class="co">#cat("Start Primary Neighborhoods:\n")</span></span>
<span id="cb80-70"><a href="#cb80-70" aria-hidden="true" tabindex="-1"></a>  <span class="co">#print(table(trips_with_neighborhoods$start_primary_neighborhood, useNA = "ifany"))</span></span>
<span id="cb80-71"><a href="#cb80-71" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb80-72"><a href="#cb80-72" aria-hidden="true" tabindex="-1"></a> <span class="co">#cat("\nEnd Primary Neighborhoods:\n")</span></span>
<span id="cb80-73"><a href="#cb80-73" aria-hidden="true" tabindex="-1"></a>  <span class="co">#print(table(trips_with_neighborhoods$end_primary_neighborhood, useNA = "ifany"))</span></span>
<span id="cb80-74"><a href="#cb80-74" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb80-75"><a href="#cb80-75" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate percentage of trips with assigned neighborhoods</span></span>
<span id="cb80-76"><a href="#cb80-76" aria-hidden="true" tabindex="-1"></a>  start_neighborhood_coverage <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="sc">!</span><span class="fu">is.na</span>(trips_with_neighborhoods<span class="sc">$</span>start_primary_neighborhood)) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb80-77"><a href="#cb80-77" aria-hidden="true" tabindex="-1"></a>  end_neighborhood_coverage <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="sc">!</span><span class="fu">is.na</span>(trips_with_neighborhoods<span class="sc">$</span>end_primary_neighborhood)) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb80-78"><a href="#cb80-78" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb80-79"><a href="#cb80-79" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Neighborhood Coverage:</span><span class="sc">\n</span><span class="st">"</span>))</span>
<span id="cb80-80"><a href="#cb80-80" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Start Neighborhood Coverage: %.2f%%</span><span class="sc">\n</span><span class="st">"</span>, start_neighborhood_coverage))</span>
<span id="cb80-81"><a href="#cb80-81" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"End Neighborhood Coverage: %.2f%%</span><span class="sc">\n</span><span class="st">"</span>, end_neighborhood_coverage))</span>
<span id="cb80-82"><a href="#cb80-82" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb80-83"><a href="#cb80-83" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(trips_with_neighborhoods)</span>
<span id="cb80-84"><a href="#cb80-84" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb80-85"><a href="#cb80-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-86"><a href="#cb80-86" aria-hidden="true" tabindex="-1"></a><span class="co"># Workflow</span></span>
<span id="cb80-87"><a href="#cb80-87" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Read neighborhoods</span></span>
<span id="cb80-88"><a href="#cb80-88" aria-hidden="true" tabindex="-1"></a>neighborhoods <span class="ot">&lt;-</span> <span class="fu">read_neighborhoods</span>(<span class="st">"C:</span><span class="sc">\\</span><span class="st">Users</span><span class="sc">\\</span><span class="st">aymen</span><span class="sc">\\</span><span class="st">Desktop</span><span class="sc">\\</span><span class="st">case_studies</span><span class="sc">\\</span><span class="st">Case_study_1</span><span class="sc">\\</span><span class="st">Neighborhoods_2012b.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 98 Columns: 5
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (3): the_geom, PRI_NEIGH, SEC_NEIGH
dbl (2): SHAPE_AREA, SHAPE_LEN

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Add neighborhoods to trips</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>all_trips <span class="ot">&lt;-</span> <span class="fu">add_neighborhoods_to_trips</span>(all_trips, neighborhoods)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Neighborhood Coverage:
Start Neighborhood Coverage: 98.52%
End Neighborhood Coverage: 98.49%</code></pre>
</div>
</div>
<p>From a total of 5,643,748 ride records, neighborhood labels were successfully assigned to the vast majority of trips:</p>
<p>Start Neighborhood Coverage: 98.52%</p>
<p>End Neighborhood Coverage: 98.48%</p>
<p>This high level of coverage demonstrates that, despite the absence of some station names (affecting ~27.95% of records), geographic context was effectively recovered through coordinate-based neighborhood mapping. As a result, nearly all trips can now be analyzed at a geographic level, enabling valuable insights into rider behavior and trends across different areas—even when exact stations were missing.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(all_trips)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Classes 'data.table' and 'data.frame':  5632258 obs. of  25 variables:
 $ ride_id                     : chr  "743252713F32516B" "BE90D33D2240C614" "D47BBDDE7C40DD61" "6684E760BF9EA9B5" ...
 $ rideable_type               : Factor w/ 3 levels "classic_bike",..: 1 2 1 1 2 1 2 2 1 1 ...
 $ started_at                  : POSIXct, format: "2024-04-22 19:08:21" "2024-04-11 06:19:24" ...
 $ ended_at                    : POSIXct, format: "2024-04-22 19:12:56" "2024-04-11 06:22:21" ...
 $ start_station_name          : chr  "Aberdeen St &amp; Jackson Blvd" "Aberdeen St &amp; Jackson Blvd" "Sheridan Rd &amp; Montrose Ave" "Aberdeen St &amp; Jackson Blvd" ...
 $ start_station_id            : chr  "13157" "13157" "TA1307000107" "13157" ...
 $ end_station_name            : chr  "Desplaines St &amp; Jackson Blvd" "Desplaines St &amp; Jackson Blvd" "Ashland Ave &amp; Belle Plaine Ave" "Desplaines St &amp; Jackson Blvd" ...
 $ end_station_id              : chr  "15539" "15539" "13249" "15539" ...
 $ start_lat                   : num  41.9 41.9 42 41.9 42 ...
 $ start_lng                   : num  -87.7 -87.7 -87.7 -87.7 -87.7 ...
 $ end_lat                     : num  41.9 41.9 42 41.9 41.9 ...
 $ end_lng                     : num  -87.6 -87.6 -87.7 -87.6 -87.6 ...
 $ member_casual               : Factor w/ 2 levels "casual","member": 2 2 2 2 2 2 2 2 2 2 ...
 $ missing_start_stations_flag : num  0 0 0 0 0 0 0 0 0 0 ...
 $ missing_end_stations_flag   : num  0 0 0 0 0 0 0 0 0 0 ...
 $ ride_duration               : num  275 177 978 226 2242 ...
 $ day_of_week                 : Factor w/ 7 levels "Sun","Mon","Tue",..: 2 5 7 5 6 4 4 5 3 7 ...
 $ hour_of_day                 : int  19 6 11 18 19 16 7 18 20 15 ...
 $ month                       : Factor w/ 12 levels "Jan","Feb","Mar",..: 4 4 4 4 4 4 4 4 4 4 ...
 $ is_weekend                  : chr  "Weekday" "Weekday" "Weekend" "Weekday" ...
 $ parts_ofday                 : chr  "Evening" "Morning" "Morning" "Evening" ...
 $ start_primary_neighborhood  : chr  "West Loop" "West Loop" "Uptown" "West Loop" ...
 $ start_secondary_neighborhood: chr  "WEST LOOP" "WEST LOOP" "UPTOWN" "WEST LOOP" ...
 $ end_primary_neighborhood    : chr  "West Loop" "West Loop" "Lake View" "West Loop" ...
 $ end_secondary_neighborhood  : chr  "WEST LOOP" "WEST LOOP" "LAKE VIEW" "WEST LOOP" ...
 - attr(*, ".internal.selfref")=&lt;externalptr&gt; </code></pre>
</div>
</div>
</section>
<section id="analysis" class="level1">
<h1>Analysis:</h1>
<section id="user-distribution-basic-metrics" class="level2">
<h2 class="anchored" data-anchor-id="user-distribution-basic-metrics">1. User Distribution &amp; Basic Metrics</h2>
<p>The dataset shows that members account for 63.5% of total rides, while casual users make up 36.5%. On average, casual riders take longer trips (19.6 minutes) compared to members (11.9 minutes).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Basic user type distribution</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>user_summary <span class="ot">&lt;-</span> all_trips[, .(</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">total_rides =</span> .N,</span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">avg_duration =</span> <span class="fu">mean</span>(ride_duration),</span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">median_duration =</span> <span class="fu">median</span>(ride_duration)</span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a>  ), by <span class="ot">=</span> member_casual</span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a>  ][, pct_of_total <span class="sc">:</span><span class="er">=</span> total_rides <span class="sc">/</span> <span class="fu">sum</span>(total_rides) <span class="sc">*</span> <span class="dv">100</span>]</span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare data for pie chart with formatted labels</span></span>
<span id="cb86-10"><a href="#cb86-10" aria-hidden="true" tabindex="-1"></a>pie_data <span class="ot">&lt;-</span> user_summary[<span class="fu">order</span>(<span class="sc">-</span>member_casual)][, <span class="st">`</span><span class="at">:=</span><span class="st">`</span>(</span>
<span id="cb86-11"><a href="#cb86-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">duration_mins =</span> <span class="fu">round</span>(avg_duration <span class="sc">/</span> <span class="dv">60</span>, <span class="dv">1</span>),</span>
<span id="cb86-12"><a href="#cb86-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">ymax =</span> <span class="fu">cumsum</span>(pct_of_total),</span>
<span id="cb86-13"><a href="#cb86-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">ymin =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">head</span>(<span class="fu">cumsum</span>(pct_of_total), <span class="at">n=</span><span class="sc">-</span><span class="dv">1</span>))</span>
<span id="cb86-14"><a href="#cb86-14" aria-hidden="true" tabindex="-1"></a>)][, <span class="st">`</span><span class="at">:=</span><span class="st">`</span>(<span class="at">pos =</span> (ymax <span class="sc">+</span> ymin) <span class="sc">/</span> <span class="dv">2</span>,</span>
<span id="cb86-15"><a href="#cb86-15" aria-hidden="true" tabindex="-1"></a>   <span class="at">label =</span> <span class="fu">paste0</span>(<span class="fu">str_to_title</span>(member_casual), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb86-16"><a href="#cb86-16" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">percent</span>(pct_of_total<span class="sc">/</span><span class="dv">100</span>, <span class="at">accuracy =</span> <span class="fl">0.1</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb86-17"><a href="#cb86-17" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Avg Duration: "</span>, duration_mins, <span class="st">" min</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb86-18"><a href="#cb86-18" aria-hidden="true" tabindex="-1"></a>   )]</span>
<span id="cb86-19"><a href="#cb86-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-20"><a href="#cb86-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Create enhanced pie chart</span></span>
<span id="cb86-21"><a href="#cb86-21" aria-hidden="true" tabindex="-1"></a>p5 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(pie_data, <span class="fu">aes</span>(<span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> pct_of_total, <span class="at">fill =</span> member_casual)) <span class="sc">+</span></span>
<span id="cb86-22"><a href="#cb86-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">width =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb86-23"><a href="#cb86-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_polar</span>(<span class="at">theta =</span> <span class="st">"y"</span>, <span class="at">start =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb86-24"><a href="#cb86-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">y =</span> pos, <span class="at">label =</span> label), </span>
<span id="cb86-25"><a href="#cb86-25" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">"white"</span>, </span>
<span id="cb86-26"><a href="#cb86-26" aria-hidden="true" tabindex="-1"></a>            <span class="at">fontface =</span> <span class="st">"bold"</span>, </span>
<span id="cb86-27"><a href="#cb86-27" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> <span class="fl">4.5</span>,</span>
<span id="cb86-28"><a href="#cb86-28" aria-hidden="true" tabindex="-1"></a>            <span class="at">lineheight =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb86-29"><a href="#cb86-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(</span>
<span id="cb86-30"><a href="#cb86-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"casual"</span> <span class="ot">=</span> <span class="st">"#4ECDC4"</span>, <span class="st">"member"</span> <span class="ot">=</span> <span class="st">"#FF6B6B"</span>),  <span class="co"># Swapped colors to match</span></span>
<span id="cb86-31"><a href="#cb86-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Casual Users"</span>, <span class="st">"Members"</span>)</span>
<span id="cb86-32"><a href="#cb86-32" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb86-33"><a href="#cb86-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb86-34"><a href="#cb86-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Bike Share Usage Distribution"</span>,</span>
<span id="cb86-35"><a href="#cb86-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Percentage of Total Rides by User Type with Key Metrics"</span>,</span>
<span id="cb86-36"><a href="#cb86-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Based on rides excluding duration outliers"</span>,</span>
<span id="cb86-37"><a href="#cb86-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"User Type"</span></span>
<span id="cb86-38"><a href="#cb86-38" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb86-39"><a href="#cb86-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb86-40"><a href="#cb86-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb86-41"><a href="#cb86-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb86-42"><a href="#cb86-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">color =</span> <span class="st">"gray60"</span>),</span>
<span id="cb86-43"><a href="#cb86-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">color =</span> <span class="st">"gray50"</span>),</span>
<span id="cb86-44"><a href="#cb86-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb86-45"><a href="#cb86-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb86-46"><a href="#cb86-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>)</span>
<span id="cb86-47"><a href="#cb86-47" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb86-48"><a href="#cb86-48" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p5)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="case_study_bikes_v1_files/figure-html/unnamed-chunk-36-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="temporal-usage-patterns" class="level2">
<h2 class="anchored" data-anchor-id="temporal-usage-patterns">2. Temporal Usage Patterns</h2>
<p>The hourly usage patterns reveal distinct behaviors between members and casual users. Members show sharp peaks during typical commute hours—around 8:00-9:00 AM and 5:00-6:00 PM—indicating regular use for work commutes. In contrast, casual users ride more steadily throughout the day, with a peak in the late afternoon, suggesting recreational or flexible usage. The heatmap further reinforces this, showing higher ride intensity for members during rush hours, while casual users peak later in the day, especially around 16:00-18:00.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="co">#2.1 Hourly Usage Patterns</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Hourly usage comparison</span></span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>hourly_usage <span class="ot">&lt;-</span> all_trips[, .(<span class="at">ride_count =</span> .N),</span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>                          by <span class="ot">=</span> .(member_casual, hour_of_day)</span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>                          ][, pct_of_user_rides <span class="sc">:</span><span class="er">=</span> </span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>                              ride_count <span class="sc">/</span> <span class="fu">sum</span>(ride_count) <span class="sc">*</span> <span class="dv">100</span>, </span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a>                            by <span class="ot">=</span> member_casual]</span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Line plot for overall comparison</span></span>
<span id="cb87-10"><a href="#cb87-10" aria-hidden="true" tabindex="-1"></a>p6 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(hourly_usage, <span class="fu">aes</span>(<span class="at">x =</span> hour_of_day, <span class="at">y =</span> pct_of_user_rides, </span>
<span id="cb87-11"><a href="#cb87-11" aria-hidden="true" tabindex="-1"></a>                               <span class="at">color =</span> member_casual, <span class="at">group =</span> member_casual)) <span class="sc">+</span></span>
<span id="cb87-12"><a href="#cb87-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="fl">1.5</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb87-13"><a href="#cb87-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>, <span class="at">alpha =</span> <span class="fl">0.9</span>) <span class="sc">+</span></span>
<span id="cb87-14"><a href="#cb87-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(</span>
<span id="cb87-15"><a href="#cb87-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"casual"</span> <span class="ot">=</span> <span class="st">"#FF6B6B"</span>, <span class="st">"member"</span> <span class="ot">=</span> <span class="st">"#4ECDC4"</span>),</span>
<span id="cb87-16"><a href="#cb87-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Casual Users"</span>, <span class="st">"Members"</span>)</span>
<span id="cb87-17"><a href="#cb87-17" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb87-18"><a href="#cb87-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">23</span>, <span class="dv">2</span>), <span class="at">labels =</span> <span class="fu">paste0</span>(<span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">23</span>, <span class="dv">2</span>), <span class="st">":00"</span>)) <span class="sc">+</span></span>
<span id="cb87-19"><a href="#cb87-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Hourly Usage Patterns"</span>,</span>
<span id="cb87-20"><a href="#cb87-20" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Commuting vs Recreation Patterns"</span>,</span>
<span id="cb87-21"><a href="#cb87-21" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Hour of Day"</span>, <span class="at">y =</span> <span class="st">"% of User's Total Rides"</span>,</span>
<span id="cb87-22"><a href="#cb87-22" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"User Type"</span>) <span class="sc">+</span></span>
<span id="cb87-23"><a href="#cb87-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb87-24"><a href="#cb87-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb87-25"><a href="#cb87-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb87-26"><a href="#cb87-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb87-27"><a href="#cb87-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span></span>
<span id="cb87-28"><a href="#cb87-28" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb87-29"><a href="#cb87-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"rect"</span>, <span class="at">xmin =</span> <span class="dv">7</span>, <span class="at">xmax =</span> <span class="dv">9</span>, <span class="at">ymin =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">ymax =</span> <span class="cn">Inf</span>, </span>
<span id="cb87-30"><a href="#cb87-30" aria-hidden="true" tabindex="-1"></a>           <span class="at">alpha =</span> <span class="fl">0.1</span>, <span class="at">fill =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb87-31"><a href="#cb87-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"rect"</span>, <span class="at">xmin =</span> <span class="dv">17</span>, <span class="at">xmax =</span> <span class="dv">19</span>, <span class="at">ymin =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">ymax =</span> <span class="cn">Inf</span>, </span>
<span id="cb87-32"><a href="#cb87-32" aria-hidden="true" tabindex="-1"></a>           <span class="at">alpha =</span> <span class="fl">0.1</span>, <span class="at">fill =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb87-33"><a href="#cb87-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">8</span>, <span class="at">y =</span> <span class="fu">max</span>(hourly_usage<span class="sc">$</span>pct_of_user_rides) <span class="sc">*</span> <span class="fl">0.9</span>, </span>
<span id="cb87-34"><a href="#cb87-34" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">"Morning</span><span class="sc">\n</span><span class="st">Commute"</span>, <span class="at">size =</span> <span class="dv">3</span>, <span class="at">color =</span> <span class="st">"darkblue"</span>) <span class="sc">+</span></span>
<span id="cb87-35"><a href="#cb87-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">18</span>, <span class="at">y =</span> <span class="fu">max</span>(hourly_usage<span class="sc">$</span>pct_of_user_rides) <span class="sc">*</span> <span class="fl">0.9</span>, </span>
<span id="cb87-36"><a href="#cb87-36" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">"Evening</span><span class="sc">\n</span><span class="st">Commute"</span>, <span class="at">size =</span> <span class="dv">3</span>, <span class="at">color =</span> <span class="st">"darkblue"</span>)</span>
<span id="cb87-37"><a href="#cb87-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-38"><a href="#cb87-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Heatmap for detailed view</span></span>
<span id="cb87-39"><a href="#cb87-39" aria-hidden="true" tabindex="-1"></a>hourly_heatmap_data <span class="ot">&lt;-</span> hourly_usage[, .(member_casual, hour_of_day, pct_of_user_rides)] <span class="sc">|&gt;</span> </span>
<span id="cb87-40"><a href="#cb87-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dcast</span>(member_casual <span class="sc">~</span> hour_of_day, <span class="at">value.var =</span> <span class="st">"pct_of_user_rides"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb87-41"><a href="#cb87-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">melt</span>(<span class="at">id.vars =</span> <span class="st">"member_casual"</span>, <span class="at">variable.name =</span> <span class="st">"hour"</span>, <span class="at">value.name =</span> <span class="st">"percentage"</span>)</span>
<span id="cb87-42"><a href="#cb87-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-43"><a href="#cb87-43" aria-hidden="true" tabindex="-1"></a>hourly_heatmap_data[, hour <span class="sc">:</span><span class="er">=</span> <span class="fu">as.numeric</span>(hour)]</span>
<span id="cb87-44"><a href="#cb87-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-45"><a href="#cb87-45" aria-hidden="true" tabindex="-1"></a>p7 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(hourly_heatmap_data, <span class="fu">aes</span>(<span class="at">x =</span> hour, <span class="at">y =</span> member_casual, <span class="at">fill =</span> percentage)) <span class="sc">+</span></span>
<span id="cb87-46"><a href="#cb87-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="at">color =</span> <span class="st">"white"</span>, <span class="at">size =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb87-47"><a href="#cb87-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient2</span>(<span class="at">low =</span> <span class="st">"white"</span>, <span class="at">mid =</span> <span class="st">"#FFE5CC"</span>, <span class="at">high =</span> <span class="st">"#FF8C42"</span>, </span>
<span id="cb87-48"><a href="#cb87-48" aria-hidden="true" tabindex="-1"></a>                       <span class="at">midpoint =</span> <span class="fu">mean</span>(hourly_heatmap_data<span class="sc">$</span>percentage),</span>
<span id="cb87-49"><a href="#cb87-49" aria-hidden="true" tabindex="-1"></a>                       <span class="at">name =</span> <span class="st">"% of Rides"</span>) <span class="sc">+</span></span>
<span id="cb87-50"><a href="#cb87-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">23</span>, <span class="dv">2</span>), <span class="at">labels =</span> <span class="fu">paste0</span>(<span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">23</span>, <span class="dv">2</span>), <span class="st">":00"</span>)) <span class="sc">+</span></span>
<span id="cb87-51"><a href="#cb87-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Casual Users"</span>, <span class="st">"Members"</span>)) <span class="sc">+</span></span>
<span id="cb87-52"><a href="#cb87-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Usage Intensity Heatmap"</span>,</span>
<span id="cb87-53"><a href="#cb87-53" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Hour of Day"</span>, <span class="at">y =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb87-54"><a href="#cb87-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb87-55"><a href="#cb87-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb87-56"><a href="#cb87-56" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb87-57"><a href="#cb87-57" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb87-58"><a href="#cb87-58" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>)</span>
<span id="cb87-59"><a href="#cb87-59" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb87-60"><a href="#cb87-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-61"><a href="#cb87-61" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine plots</span></span>
<span id="cb87-62"><a href="#cb87-62" aria-hidden="true" tabindex="-1"></a>(p6 <span class="sc">/</span> p7) <span class="sc">+</span> <span class="fu">plot_layout</span>(<span class="at">heights =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="case_study_bikes_v1_files/figure-html/unnamed-chunk-37-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Casual users tend to ride more on weekends, especially on Saturdays (20.8%) and Sundays (16.9%), consistent with recreational usage. Meanwhile, members have a more even distribution throughout the workweek, with the highest activity on Wednesdays (16.2%), indicating regular commuting. This reinforces the insight that casual users are more active during leisure periods, while members use the service more routinely during weekdays.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="co">#2.2 Daily Usage Patterns</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Daily usage patterns</span></span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>daily_usage <span class="ot">&lt;-</span> all_trips[, .(<span class="at">ride_count =</span> .N) ,</span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>                         by <span class="ot">=</span> .(member_casual, day_of_week)</span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>                         ][, pct_of_user_rides <span class="sc">:</span><span class="er">=</span></span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>                             ride_count <span class="sc">/</span> <span class="fu">sum</span>(ride_count) <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a>                           by <span class="ot">=</span> member_casual]</span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Weekend vs Weekday analysis</span></span>
<span id="cb88-10"><a href="#cb88-10" aria-hidden="true" tabindex="-1"></a>weekend_analysis <span class="ot">&lt;-</span> all_trips[, .(</span>
<span id="cb88-11"><a href="#cb88-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">ride_count =</span> .N,</span>
<span id="cb88-12"><a href="#cb88-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">avg_duration =</span> <span class="fu">mean</span>(ride_duration)</span>
<span id="cb88-13"><a href="#cb88-13" aria-hidden="true" tabindex="-1"></a>  ), by <span class="ot">=</span> .(member_casual, is_weekend)</span>
<span id="cb88-14"><a href="#cb88-14" aria-hidden="true" tabindex="-1"></a>  ][, pct_rides <span class="sc">:</span><span class="er">=</span> ride_count <span class="sc">/</span> <span class="fu">sum</span>(ride_count) <span class="sc">*</span> <span class="dv">100</span>, by <span class="ot">=</span> member_casual]</span>
<span id="cb88-15"><a href="#cb88-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-16"><a href="#cb88-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-17"><a href="#cb88-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Enhanced daily patterns visualization</span></span>
<span id="cb88-18"><a href="#cb88-18" aria-hidden="true" tabindex="-1"></a>p8 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(daily_usage, <span class="fu">aes</span>(<span class="at">x =</span> day_of_week, <span class="at">y =</span> pct_of_user_rides, </span>
<span id="cb88-19"><a href="#cb88-19" aria-hidden="true" tabindex="-1"></a>                              <span class="at">fill =</span> member_casual, <span class="at">group =</span> member_casual)) <span class="sc">+</span></span>
<span id="cb88-20"><a href="#cb88-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="st">"dodge"</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>, <span class="at">width =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb88-21"><a href="#cb88-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(</span>
<span id="cb88-22"><a href="#cb88-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"casual"</span> <span class="ot">=</span> <span class="st">"#FF6B6B"</span>, <span class="st">"member"</span> <span class="ot">=</span> <span class="st">"#4ECDC4"</span>),</span>
<span id="cb88-23"><a href="#cb88-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Casual Users"</span>, <span class="st">"Members"</span>)</span>
<span id="cb88-24"><a href="#cb88-24" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb88-25"><a href="#cb88-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Daily Usage Distribution"</span>,</span>
<span id="cb88-26"><a href="#cb88-26" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Weekday vs Weekend Patterns"</span>,</span>
<span id="cb88-27"><a href="#cb88-27" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Day of Week"</span>, <span class="at">y =</span> <span class="st">"% of User's Total Rides"</span>,</span>
<span id="cb88-28"><a href="#cb88-28" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">"User Type"</span>) <span class="sc">+</span></span>
<span id="cb88-29"><a href="#cb88-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb88-30"><a href="#cb88-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb88-31"><a href="#cb88-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb88-32"><a href="#cb88-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb88-33"><a href="#cb88-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>)</span>
<span id="cb88-34"><a href="#cb88-34" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb88-35"><a href="#cb88-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">100</span><span class="sc">/</span><span class="dv">7</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">color =</span> <span class="st">"gray50"</span>) <span class="sc">+</span></span>
<span id="cb88-36"><a href="#cb88-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">4</span>, <span class="at">y =</span> <span class="dv">100</span><span class="sc">/</span><span class="dv">7</span> <span class="sc">+</span> <span class="dv">1</span>, <span class="at">label =</span> <span class="st">"Equal Distribution Line"</span>, </span>
<span id="cb88-37"><a href="#cb88-37" aria-hidden="true" tabindex="-1"></a>           <span class="at">size =</span> <span class="dv">3</span>, <span class="at">color =</span> <span class="st">"gray50"</span>)</span>
<span id="cb88-38"><a href="#cb88-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-39"><a href="#cb88-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Weekend impact analysis</span></span>
<span id="cb88-40"><a href="#cb88-40" aria-hidden="true" tabindex="-1"></a>p9 <span class="ot">&lt;-</span> weekend_analysis <span class="sc">%&gt;%</span></span>
<span id="cb88-41"><a href="#cb88-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(member_casual, is_weekend, pct_rides) <span class="sc">%&gt;%</span></span>
<span id="cb88-42"><a href="#cb88-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> is_weekend, <span class="at">y =</span> pct_rides, <span class="at">fill =</span> member_casual)) <span class="sc">+</span></span>
<span id="cb88-43"><a href="#cb88-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="st">"dodge"</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>, <span class="at">width =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb88-44"><a href="#cb88-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(</span>
<span id="cb88-45"><a href="#cb88-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"casual"</span> <span class="ot">=</span> <span class="st">"#FF6B6B"</span>, <span class="st">"member"</span> <span class="ot">=</span> <span class="st">"#4ECDC4"</span>),</span>
<span id="cb88-46"><a href="#cb88-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Casual Users"</span>, <span class="st">"Members"</span>)</span>
<span id="cb88-47"><a href="#cb88-47" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb88-48"><a href="#cb88-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Weekend vs Weekday Usage"</span>,</span>
<span id="cb88-49"><a href="#cb88-49" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> <span class="st">"% of User's Total Rides"</span>,</span>
<span id="cb88-50"><a href="#cb88-50" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">"User Type"</span>) <span class="sc">+</span></span>
<span id="cb88-51"><a href="#cb88-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb88-52"><a href="#cb88-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb88-53"><a href="#cb88-53" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb88-54"><a href="#cb88-54" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"none"</span></span>
<span id="cb88-55"><a href="#cb88-55" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb88-56"><a href="#cb88-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">paste0</span>(<span class="fu">round</span>(pct_rides, <span class="dv">1</span>), <span class="st">"%"</span>)), </span>
<span id="cb88-57"><a href="#cb88-57" aria-hidden="true" tabindex="-1"></a>            <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.6</span>), <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">4</span>)</span>
<span id="cb88-58"><a href="#cb88-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-59"><a href="#cb88-59" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine daily visualizations</span></span>
<span id="cb88-60"><a href="#cb88-60" aria-hidden="true" tabindex="-1"></a>(p8 <span class="sc">|</span> p9) <span class="sc">+</span> <span class="fu">plot_layout</span>(<span class="at">widths =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="case_study_bikes_v1_files/figure-html/unnamed-chunk-38-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>This seasonal chart highlights monthly ridership and trip duration trends. Casual users show a sharp increase in rides during warmer months (May–September), peaking in July and August, suggesting recreational use. Their trip durations are also much longer, especially in summer, reaching over 22 minutes on average. In contrast, members have more consistent usage throughout the year with shorter, steadier trip durations (around 12 minutes), reinforcing the pattern of regular, purpose-driven commuting.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="co">#2.3 Monthly Patterns</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Seasonal usage patterns</span></span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>monthly_usage <span class="ot">&lt;-</span> all_trips[, .(</span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">ride_count =</span> .N,</span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">avg_duration =</span> <span class="fu">mean</span>(ride_duration)), by <span class="ot">=</span> .(member_casual, month)</span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a>  ][, pct_of_user_rides <span class="sc">:</span><span class="er">=</span> ride_count <span class="sc">/</span> <span class="fu">sum</span>(ride_count) <span class="sc">*</span> <span class="dv">100</span>, by <span class="ot">=</span> member_casual]</span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-8"><a href="#cb89-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-9"><a href="#cb89-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Enhanced monthly visualization with dual metrics</span></span>
<span id="cb89-10"><a href="#cb89-10" aria-hidden="true" tabindex="-1"></a>p10 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(monthly_usage, <span class="fu">aes</span>(<span class="at">x =</span> month, <span class="at">group =</span> member_casual)) <span class="sc">+</span></span>
<span id="cb89-11"><a href="#cb89-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Ride count bars</span></span>
<span id="cb89-12"><a href="#cb89-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">y =</span> pct_of_user_rides, <span class="at">fill =</span> member_casual), </span>
<span id="cb89-13"><a href="#cb89-13" aria-hidden="true" tabindex="-1"></a>           <span class="at">position =</span> <span class="st">"dodge"</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">width =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb89-14"><a href="#cb89-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Duration line overlay</span></span>
<span id="cb89-15"><a href="#cb89-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> avg_duration<span class="sc">/</span><span class="dv">60</span> <span class="sc">*</span> <span class="dv">2</span>, <span class="at">color =</span> member_casual), </span>
<span id="cb89-16"><a href="#cb89-16" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> <span class="fl">1.2</span>, <span class="at">alpha =</span> <span class="fl">0.9</span>) <span class="sc">+</span></span>
<span id="cb89-17"><a href="#cb89-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> avg_duration<span class="sc">/</span><span class="dv">60</span> <span class="sc">*</span> <span class="dv">2</span>, <span class="at">color =</span> member_casual), </span>
<span id="cb89-18"><a href="#cb89-18" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="dv">3</span>, <span class="at">alpha =</span> <span class="fl">0.9</span>) <span class="sc">+</span></span>
<span id="cb89-19"><a href="#cb89-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb89-20"><a href="#cb89-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(</span>
<span id="cb89-21"><a href="#cb89-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"casual"</span> <span class="ot">=</span> <span class="st">"#FF6B6B"</span>, <span class="st">"member"</span> <span class="ot">=</span> <span class="st">"#4ECDC4"</span>),</span>
<span id="cb89-22"><a href="#cb89-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Casual Users"</span>, <span class="st">"Members"</span>),</span>
<span id="cb89-23"><a href="#cb89-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"User Type"</span></span>
<span id="cb89-24"><a href="#cb89-24" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb89-25"><a href="#cb89-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(</span>
<span id="cb89-26"><a href="#cb89-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"casual"</span> <span class="ot">=</span> <span class="st">"#CC0000"</span>, <span class="st">"member"</span> <span class="ot">=</span> <span class="st">"#008B8B"</span>),</span>
<span id="cb89-27"><a href="#cb89-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Casual Users"</span>, <span class="st">"Members"</span>),</span>
<span id="cb89-28"><a href="#cb89-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"User Type"</span></span>
<span id="cb89-29"><a href="#cb89-29" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb89-30"><a href="#cb89-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb89-31"><a href="#cb89-31" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Dual y-axis setup</span></span>
<span id="cb89-32"><a href="#cb89-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(</span>
<span id="cb89-33"><a href="#cb89-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"% of User's Total Rides"</span>,</span>
<span id="cb89-34"><a href="#cb89-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">sec.axis =</span> <span class="fu">sec_axis</span>(<span class="sc">~</span> . <span class="sc">/</span> <span class="dv">2</span>, <span class="at">name =</span> <span class="st">"Average Duration (minutes)"</span>)</span>
<span id="cb89-35"><a href="#cb89-35" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb89-36"><a href="#cb89-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb89-37"><a href="#cb89-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Seasonal Usage Patterns"</span>,</span>
<span id="cb89-38"><a href="#cb89-38" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Monthly Distribution and Average Trip Duration"</span>,</span>
<span id="cb89-39"><a href="#cb89-39" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Month"</span>,</span>
<span id="cb89-40"><a href="#cb89-40" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">"Bars show ride distribution, lines show average duration"</span>) <span class="sc">+</span></span>
<span id="cb89-41"><a href="#cb89-41" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb89-42"><a href="#cb89-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb89-43"><a href="#cb89-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb89-44"><a href="#cb89-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb89-45"><a href="#cb89-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb89-46"><a href="#cb89-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb89-47"><a href="#cb89-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y.left =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb89-48"><a href="#cb89-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y.right =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"darkred"</span>)</span>
<span id="cb89-49"><a href="#cb89-49" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb89-50"><a href="#cb89-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-51"><a href="#cb89-51" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p10)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="case_study_bikes_v1_files/figure-html/unnamed-chunk-39-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Seasonal summary table</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>seasonal_summary <span class="ot">&lt;-</span> monthly_usage[</span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>  , season <span class="sc">:</span><span class="er">=</span> <span class="fu">fcase</span>(</span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>    month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Dec"</span>, <span class="st">"Jan"</span>, <span class="st">"Feb"</span>), <span class="st">"Winter"</span>,</span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>    month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Mar"</span>, <span class="st">"Apr"</span>, <span class="st">"May"</span>), <span class="st">"Spring"</span>, </span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a>    month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Jun"</span>, <span class="st">"Jul"</span>, <span class="st">"Aug"</span>), <span class="st">"Summer"</span>,</span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a>    month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Sep"</span>, <span class="st">"Oct"</span>, <span class="st">"Nov"</span>), <span class="st">"Fall"</span></span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a>    )][</span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true" tabindex="-1"></a>      , .(<span class="at">total_pct =</span> <span class="fu">sum</span>(pct_of_user_rides),</span>
<span id="cb90-10"><a href="#cb90-10" aria-hidden="true" tabindex="-1"></a>          <span class="at">avg_duration_mins =</span> <span class="fu">mean</span>(avg_duration) <span class="sc">/</span> <span class="dv">60</span>),</span>
<span id="cb90-11"><a href="#cb90-11" aria-hidden="true" tabindex="-1"></a>      by <span class="ot">=</span> .(member_casual, season)][</span>
<span id="cb90-12"><a href="#cb90-12" aria-hidden="true" tabindex="-1"></a>        <span class="fu">order</span>(member_casual, <span class="fu">match</span>(season, <span class="fu">c</span>(<span class="st">"Spring"</span>, <span class="st">"Summer"</span>,</span>
<span id="cb90-13"><a href="#cb90-13" aria-hidden="true" tabindex="-1"></a>                                             <span class="st">"Fall"</span>, <span class="st">"Winter"</span>)))</span>
<span id="cb90-14"><a href="#cb90-14" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb90-15"><a href="#cb90-15" aria-hidden="true" tabindex="-1"></a>seasonal_summary</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   member_casual season total_pct avg_duration_mins
          &lt;fctr&gt; &lt;char&gt;     &lt;num&gt;             &lt;num&gt;
1:        casual Spring 21.012243         19.539527
2:        casual Summer 43.925707         21.335293
3:        casual   Fall 30.799507         17.011741
4:        casual Winter  4.262543         11.609523
5:        member Spring 23.884281         11.718061
6:        member Summer 35.029252         12.931490
7:        member   Fall 30.699735         11.237029
8:        member Winter 10.386732          9.705516</code></pre>
</div>
</div>
</section>
<section id="trip-characteristics-analysis" class="level2">
<h2 class="anchored" data-anchor-id="trip-characteristics-analysis">3. Trip Characteristics Analysis</h2>
<p>This ride duration distribution graph shows that casual users tend to have longer trips than members do, suggesting recreational use.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="co">#3.1 Duration Analysis</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>p11 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(all_trips[ride_duration <span class="sc">&lt;=</span> <span class="dv">11700</span>], </span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">x =</span> ride_duration<span class="sc">/</span><span class="dv">60</span>, <span class="at">fill =</span> member_casual)) <span class="sc">+</span></span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">bins =</span> <span class="dv">60</span>, <span class="at">position =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"casual"</span> <span class="ot">=</span> <span class="st">"#FF6B6B"</span>, <span class="st">"member"</span> <span class="ot">=</span> <span class="st">"#4ECDC4"</span>)) <span class="sc">+</span></span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Trip Duration Distribution"</span>,</span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Duration (minutes)"</span>, </span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Count"</span>) <span class="sc">+</span></span>
<span id="cb92-9"><a href="#cb92-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">10</span>, <span class="dv">100</span>, <span class="dv">1000</span>)) <span class="sc">+</span></span>
<span id="cb92-10"><a href="#cb92-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb92-11"><a href="#cb92-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-12"><a href="#cb92-12" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p11)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="case_study_bikes_v1_files/figure-html/unnamed-chunk-40-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="bike-type-preferences" class="level2">
<h2 class="anchored" data-anchor-id="bike-type-preferences">4. Bike Type Preferences</h2>
<p>The graphs illustrate differences in bike type preferences and average trip durations between casual users and members. Both groups show a similar distribution in bike type preferences, with electric bikes being the most popular, followed by classic bikes, and electric scooters being the least used. However, when it comes to average trip duration, casual users consistently take longer rides across all bike types. The most notable gap is for classic bikes, where casual users ride for significantly longer durations than members. This suggests that casual users may be using the service for leisure or exploration, while members likely use it for quicker, more routine trips.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="co">#5.1 Bike Type Usage</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Bike type preferences</span></span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>bike_type_usage <span class="ot">&lt;-</span> all_trips[</span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>  , .(<span class="at">ride_count =</span> .N),</span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a>  by <span class="ot">=</span> .(member_casual, rideable_type)</span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a>  ][,</span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a>    pct_of_user_rides <span class="sc">:</span><span class="er">=</span> ride_count <span class="sc">/</span> <span class="fu">sum</span>(ride_count) <span class="sc">*</span> <span class="dv">100</span> ,</span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a>    by <span class="ot">=</span> member_casual]</span>
<span id="cb93-9"><a href="#cb93-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-10"><a href="#cb93-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Bike type by trip characteristics</span></span>
<span id="cb93-11"><a href="#cb93-11" aria-hidden="true" tabindex="-1"></a>bike_trip_chars <span class="ot">&lt;-</span> all_trips[</span>
<span id="cb93-12"><a href="#cb93-12" aria-hidden="true" tabindex="-1"></a>  , .(<span class="at">avg_duration =</span> <span class="fu">mean</span>(ride_duration),</span>
<span id="cb93-13"><a href="#cb93-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">avg_rides_per_hour =</span> .N <span class="sc">/</span> <span class="fu">n_distinct</span>(<span class="fu">paste</span>(</span>
<span id="cb93-14"><a href="#cb93-14" aria-hidden="true" tabindex="-1"></a>        <span class="fu">date</span>(started_at),</span>
<span id="cb93-15"><a href="#cb93-15" aria-hidden="true" tabindex="-1"></a>        hour_of_day))),</span>
<span id="cb93-16"><a href="#cb93-16" aria-hidden="true" tabindex="-1"></a>  by <span class="ot">=</span> .(member_casual, rideable_type)]</span>
<span id="cb93-17"><a href="#cb93-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-18"><a href="#cb93-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-19"><a href="#cb93-19" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Simple stacked bar chart - Bike type usage percentage</span></span>
<span id="cb93-20"><a href="#cb93-20" aria-hidden="true" tabindex="-1"></a>p12 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(bike_type_usage, <span class="fu">aes</span>(<span class="at">x =</span> member_casual, <span class="at">y =</span> pct_of_user_rides, <span class="at">fill =</span> rideable_type)) <span class="sc">+</span></span>
<span id="cb93-21"><a href="#cb93-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb93-22"><a href="#cb93-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"classic_bike"</span> <span class="ot">=</span> <span class="st">"#4ECDC4"</span>, </span>
<span id="cb93-23"><a href="#cb93-23" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"electric_bike"</span> <span class="ot">=</span> <span class="st">"#FFE66D"</span>, </span>
<span id="cb93-24"><a href="#cb93-24" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"electric_scooter"</span> <span class="ot">=</span> <span class="st">"#FF6B6B"</span>)) <span class="sc">+</span></span>
<span id="cb93-25"><a href="#cb93-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Bike Type Preferences by User Type"</span>,</span>
<span id="cb93-26"><a href="#cb93-26" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"User Type"</span>, </span>
<span id="cb93-27"><a href="#cb93-27" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Percentage (%)"</span>,</span>
<span id="cb93-28"><a href="#cb93-28" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">"Bike Type"</span>) <span class="sc">+</span></span>
<span id="cb93-29"><a href="#cb93-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb93-30"><a href="#cb93-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-31"><a href="#cb93-31" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Side-by-side comparison - Average duration by bike type</span></span>
<span id="cb93-32"><a href="#cb93-32" aria-hidden="true" tabindex="-1"></a>p13 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(bike_trip_chars, <span class="fu">aes</span>(<span class="at">x =</span> rideable_type, <span class="at">y =</span> avg_duration<span class="sc">/</span><span class="dv">60</span>, <span class="at">fill =</span> member_casual)) <span class="sc">+</span></span>
<span id="cb93-33"><a href="#cb93-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="st">"dodge"</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb93-34"><a href="#cb93-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"casual"</span> <span class="ot">=</span> <span class="st">"#FF6B6B"</span>, <span class="st">"member"</span> <span class="ot">=</span> <span class="st">"#4ECDC4"</span>)) <span class="sc">+</span></span>
<span id="cb93-35"><a href="#cb93-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Average Trip Duration by Bike Type"</span>,</span>
<span id="cb93-36"><a href="#cb93-36" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Bike Type"</span>, </span>
<span id="cb93-37"><a href="#cb93-37" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Duration (minutes)"</span>,</span>
<span id="cb93-38"><a href="#cb93-38" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">"User Type"</span>) <span class="sc">+</span></span>
<span id="cb93-39"><a href="#cb93-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb93-40"><a href="#cb93-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-41"><a href="#cb93-41" aria-hidden="true" tabindex="-1"></a>(p12 <span class="sc">|</span> p13) <span class="sc">+</span> <span class="fu">plot_layout</span>(<span class="at">widths =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="case_study_bikes_v1_files/figure-html/unnamed-chunk-41-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="map-of-bike-stations-and-neighborhoods-by-station-density" class="level2">
<h2 class="anchored" data-anchor-id="map-of-bike-stations-and-neighborhoods-by-station-density">5. Map of bike stations and neighborhoods by station density</h2>
<p>Unique stations were plotted on the Chicago map, and neighborhoods were analyzed by station density, taking into account each neighborhood’s area. This reveals which areas have higher or lower bike station coverage relative to their size.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert stations to an sf object</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>stations_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(all_station_records, </span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"lng"</span>, <span class="st">"lat"</span>), </span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>                        <span class="at">crs =</span> <span class="fu">st_crs</span>(neighborhoods))</span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Count stations per neighborhood</span></span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a>neighborhood_station_count <span class="ot">&lt;-</span> stations_sf <span class="sc">|&gt;</span> </span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_join</span>(neighborhoods) <span class="sc">|&gt;</span> </span>
<span id="cb94-9"><a href="#cb94-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(PRI_NEIGH) <span class="sc">|&gt;</span> </span>
<span id="cb94-10"><a href="#cb94-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">station_count =</span> <span class="fu">n</span>())</span>
<span id="cb94-11"><a href="#cb94-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-12"><a href="#cb94-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge station count with neighborhood geometries</span></span>
<span id="cb94-13"><a href="#cb94-13" aria-hidden="true" tabindex="-1"></a>neighborhoods_with_stations <span class="ot">&lt;-</span> neighborhoods <span class="sc">|&gt;</span> </span>
<span id="cb94-14"><a href="#cb94-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="fu">as.data.frame</span>(neighborhood_station_count), <span class="at">by =</span> <span class="st">"PRI_NEIGH"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb94-15"><a href="#cb94-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Replace NA with 0</span></span>
<span id="cb94-16"><a href="#cb94-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">station_count =</span> <span class="fu">replace_na</span>(station_count, <span class="dv">0</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb94-17"><a href="#cb94-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate area in square kilometers (SHAPE_AREA is likely in square meters)</span></span>
<span id="cb94-18"><a href="#cb94-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">area_sq_km =</span> SHAPE_AREA <span class="sc">/</span> <span class="dv">1000000</span>) <span class="sc">|&gt;</span> </span>
<span id="cb94-19"><a href="#cb94-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate station density (stations per square km)</span></span>
<span id="cb94-20"><a href="#cb94-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">station_density =</span> station_count <span class="sc">/</span> area_sq_km)</span>
<span id="cb94-21"><a href="#cb94-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-22"><a href="#cb94-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the density map</span></span>
<span id="cb94-23"><a href="#cb94-23" aria-hidden="true" tabindex="-1"></a>p14 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb94-24"><a href="#cb94-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Plot neighborhood polygons with fill based on station density</span></span>
<span id="cb94-25"><a href="#cb94-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> neighborhoods_with_stations, </span>
<span id="cb94-26"><a href="#cb94-26" aria-hidden="true" tabindex="-1"></a>          <span class="fu">aes</span>(<span class="at">fill =</span> station_density), </span>
<span id="cb94-27"><a href="#cb94-27" aria-hidden="true" tabindex="-1"></a>          <span class="at">color =</span> <span class="st">"white"</span>, </span>
<span id="cb94-28"><a href="#cb94-28" aria-hidden="true" tabindex="-1"></a>          <span class="at">size =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb94-29"><a href="#cb94-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add station points</span></span>
<span id="cb94-30"><a href="#cb94-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> stations_sf, </span>
<span id="cb94-31"><a href="#cb94-31" aria-hidden="true" tabindex="-1"></a>          <span class="at">color =</span> <span class="st">"red"</span>, </span>
<span id="cb94-32"><a href="#cb94-32" aria-hidden="true" tabindex="-1"></a>          <span class="at">alpha =</span> <span class="fl">0.5</span>, </span>
<span id="cb94-33"><a href="#cb94-33" aria-hidden="true" tabindex="-1"></a>          <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb94-34"><a href="#cb94-34" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Customize the color scale</span></span>
<span id="cb94-35"><a href="#cb94-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">low =</span> <span class="st">"lightblue"</span>, <span class="at">high =</span> <span class="st">"darkblue"</span>, </span>
<span id="cb94-36"><a href="#cb94-36" aria-hidden="true" tabindex="-1"></a>                     <span class="at">name =</span> <span class="st">"Stations per</span><span class="sc">\n</span><span class="st">square km"</span>,</span>
<span id="cb94-37"><a href="#cb94-37" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">number_format</span>(<span class="at">accuracy =</span> <span class="fl">0.1</span>)) <span class="sc">+</span></span>
<span id="cb94-38"><a href="#cb94-38" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add title and theme</span></span>
<span id="cb94-39"><a href="#cb94-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Chicago Bike Share Station Density by Neighborhood"</span>,</span>
<span id="cb94-40"><a href="#cb94-40" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Red points represent individual stations"</span>,</span>
<span id="cb94-41"><a href="#cb94-41" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">"Data source: Bike Share Trip Dataset"</span>) <span class="sc">+</span></span>
<span id="cb94-42"><a href="#cb94-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb94-43"><a href="#cb94-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb94-44"><a href="#cb94-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb94-45"><a href="#cb94-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb94-46"><a href="#cb94-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"right"</span></span>
<span id="cb94-47"><a href="#cb94-47" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb94-48"><a href="#cb94-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-49"><a href="#cb94-49" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p14)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="case_study_bikes_v1_files/figure-html/unnamed-chunk-42-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Additional Analysis: Station Density</span></span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Neighborhoods with Highest Bike Share Station Density:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Neighborhoods with Highest Bike Share Station Density:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>neighborhoods_with_stations <span class="sc">|&gt;</span> </span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">|&gt;</span> </span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(station_density)) <span class="sc">|&gt;</span> </span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(PRI_NEIGH, station_count, area_sq_km, station_density) <span class="sc">|&gt;</span> </span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>) <span class="sc">|&gt;</span> </span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 4
   PRI_NEIGH       station_count area_sq_km station_density
   &lt;chr&gt;                   &lt;int&gt;      &lt;dbl&gt;           &lt;dbl&gt;
 1 Boystown                    5       3.37           1.49 
 2 Rush &amp; Division             4       3.49           1.15 
 3 Loop                       33      31.5            1.05 
 4 Printers Row                2       2.16           0.925
 5 River North                32      38.8            0.825
 6 West Loop                  36      52.9            0.680
 7 Streeterville              12      17.9            0.671
 8 East Village                4       7.05           0.567
 9 Chinatown                   6      10.6            0.565
10 Old Town                   10      19.8            0.504</code></pre>
</div>
</div>
</section>
<section id="geographical-analysis" class="level2">
<h2 class="anchored" data-anchor-id="geographical-analysis">6- Geographical analysis</h2>
<p>This map shows the top 10 start stations for both user types, zoomed into central Chicago. Casual users concentrate along the lakefront and tourist areas like Streeterville and the Loop, while members cluster in business districts such as River North and West Loop. The geographic separation clearly reflects the recreational vs.&nbsp;commuter usage patterns, with casual riders preferring tourist destinations and members choosing stations near commercial areas that support daily commuting needs.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get top 10 START stations for each user type with neighborhood info</span></span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>top_start_stations_by_user <span class="ot">&lt;-</span> all_trips[</span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>  <span class="sc">!</span><span class="fu">is.na</span>(start_station_name),</span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a>  .(<span class="at">trip_count =</span> .N),</span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a>  by <span class="ot">=</span> .(member_casual, start_station_name, start_station_id, start_lat, start_lng, start_primary_neighborhood, start_secondary_neighborhood)</span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a>  ][</span>
<span id="cb99-7"><a href="#cb99-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">order</span>(<span class="sc">-</span>trip_count),</span>
<span id="cb99-8"><a href="#cb99-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">head</span>(.SD, <span class="dv">10</span>),</span>
<span id="cb99-9"><a href="#cb99-9" aria-hidden="true" tabindex="-1"></a>    by <span class="ot">=</span> member_casual]</span>
<span id="cb99-10"><a href="#cb99-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-11"><a href="#cb99-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to sf object for mapping</span></span>
<span id="cb99-12"><a href="#cb99-12" aria-hidden="true" tabindex="-1"></a>top_start_stations_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(top_start_stations_by_user, </span>
<span id="cb99-13"><a href="#cb99-13" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"start_lng"</span>, <span class="st">"start_lat"</span>), </span>
<span id="cb99-14"><a href="#cb99-14" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">crs =</span> <span class="dv">4326</span>)</span>
<span id="cb99-15"><a href="#cb99-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-16"><a href="#cb99-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Fix neighborhoods dataset</span></span>
<span id="cb99-17"><a href="#cb99-17" aria-hidden="true" tabindex="-1"></a>neighborhoods_clean <span class="ot">&lt;-</span> neighborhoods  <span class="sc">|&gt;</span> </span>
<span id="cb99-18"><a href="#cb99-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_make_valid</span>() <span class="sc">|&gt;</span> </span>
<span id="cb99-19"><a href="#cb99-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="dv">4326</span>)</span>
<span id="cb99-20"><a href="#cb99-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-21"><a href="#cb99-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate bounding box and add padding</span></span>
<span id="cb99-22"><a href="#cb99-22" aria-hidden="true" tabindex="-1"></a>bbox_start <span class="ot">&lt;-</span> <span class="fu">st_bbox</span>(top_start_stations_sf)</span>
<span id="cb99-23"><a href="#cb99-23" aria-hidden="true" tabindex="-1"></a>padding <span class="ot">&lt;-</span> <span class="fl">0.01</span></span>
<span id="cb99-24"><a href="#cb99-24" aria-hidden="true" tabindex="-1"></a>bbox_start[<span class="dv">1</span>] <span class="ot">&lt;-</span> bbox_start[<span class="dv">1</span>] <span class="sc">-</span> padding</span>
<span id="cb99-25"><a href="#cb99-25" aria-hidden="true" tabindex="-1"></a>bbox_start[<span class="dv">2</span>] <span class="ot">&lt;-</span> bbox_start[<span class="dv">2</span>] <span class="sc">-</span> padding</span>
<span id="cb99-26"><a href="#cb99-26" aria-hidden="true" tabindex="-1"></a>bbox_start[<span class="dv">3</span>] <span class="ot">&lt;-</span> bbox_start[<span class="dv">3</span>] <span class="sc">+</span> padding</span>
<span id="cb99-27"><a href="#cb99-27" aria-hidden="true" tabindex="-1"></a>bbox_start[<span class="dv">4</span>] <span class="ot">&lt;-</span> bbox_start[<span class="dv">4</span>] <span class="sc">+</span> padding</span>
<span id="cb99-28"><a href="#cb99-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-29"><a href="#cb99-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Get top 3 stations for labels</span></span>
<span id="cb99-30"><a href="#cb99-30" aria-hidden="true" tabindex="-1"></a>top_start_stations_for_labels <span class="ot">&lt;-</span> top_start_stations_sf <span class="sc">|&gt;</span> </span>
<span id="cb99-31"><a href="#cb99-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(member_casual) <span class="sc">|&gt;</span> </span>
<span id="cb99-32"><a href="#cb99-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(trip_count, <span class="at">n =</span> <span class="dv">3</span>) <span class="sc">|&gt;</span> </span>
<span id="cb99-33"><a href="#cb99-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb99-34"><a href="#cb99-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-35"><a href="#cb99-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Create START stations map with labels and neighborhood annotations</span></span>
<span id="cb99-36"><a href="#cb99-36" aria-hidden="true" tabindex="-1"></a>chicago_start_map <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb99-37"><a href="#cb99-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> neighborhoods_clean, </span>
<span id="cb99-38"><a href="#cb99-38" aria-hidden="true" tabindex="-1"></a>          <span class="at">fill =</span> <span class="st">"lightgray"</span>, </span>
<span id="cb99-39"><a href="#cb99-39" aria-hidden="true" tabindex="-1"></a>          <span class="at">color =</span> <span class="st">"white"</span>, </span>
<span id="cb99-40"><a href="#cb99-40" aria-hidden="true" tabindex="-1"></a>          <span class="at">size =</span> <span class="fl">0.3</span>, </span>
<span id="cb99-41"><a href="#cb99-41" aria-hidden="true" tabindex="-1"></a>          <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb99-42"><a href="#cb99-42" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb99-43"><a href="#cb99-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> top_start_stations_sf, </span>
<span id="cb99-44"><a href="#cb99-44" aria-hidden="true" tabindex="-1"></a>          <span class="fu">aes</span>(<span class="at">color =</span> member_casual, <span class="at">size =</span> trip_count), </span>
<span id="cb99-45"><a href="#cb99-45" aria-hidden="true" tabindex="-1"></a>          <span class="at">alpha =</span> <span class="fl">0.9</span>) <span class="sc">+</span></span>
<span id="cb99-46"><a href="#cb99-46" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb99-47"><a href="#cb99-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf_text</span>(<span class="at">data =</span> top_start_stations_for_labels,</span>
<span id="cb99-48"><a href="#cb99-48" aria-hidden="true" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">paste0</span>(<span class="fu">substr</span>(start_station_name, <span class="dv">1</span>, <span class="dv">15</span>), </span>
<span id="cb99-49"><a href="#cb99-49" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">if_else</span>(<span class="fu">nchar</span>(start_station_name) <span class="sc">&gt;</span> <span class="dv">15</span>, <span class="st">"..."</span>, <span class="st">""</span>))),</span>
<span id="cb99-50"><a href="#cb99-50" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> <span class="fl">2.2</span>, </span>
<span id="cb99-51"><a href="#cb99-51" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb99-52"><a href="#cb99-52" aria-hidden="true" tabindex="-1"></a>               <span class="at">fontface =</span> <span class="st">"bold"</span>,</span>
<span id="cb99-53"><a href="#cb99-53" aria-hidden="true" tabindex="-1"></a>               <span class="at">nudge_y =</span> <span class="fl">0.003</span>,</span>
<span id="cb99-54"><a href="#cb99-54" aria-hidden="true" tabindex="-1"></a>               <span class="at">check_overlap =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb99-55"><a href="#cb99-55" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb99-56"><a href="#cb99-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf_text</span>(<span class="at">data =</span> top_start_stations_for_labels,</span>
<span id="cb99-57"><a href="#cb99-57" aria-hidden="true" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">label =</span> start_primary_neighborhood),</span>
<span id="cb99-58"><a href="#cb99-58" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> <span class="fl">1.8</span>, </span>
<span id="cb99-59"><a href="#cb99-59" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">"darkblue"</span>,</span>
<span id="cb99-60"><a href="#cb99-60" aria-hidden="true" tabindex="-1"></a>               <span class="at">style =</span> <span class="st">"italic"</span>,</span>
<span id="cb99-61"><a href="#cb99-61" aria-hidden="true" tabindex="-1"></a>               <span class="at">nudge_y =</span> <span class="sc">-</span><span class="fl">0.003</span>,</span>
<span id="cb99-62"><a href="#cb99-62" aria-hidden="true" tabindex="-1"></a>               <span class="at">check_overlap =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb99-63"><a href="#cb99-63" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb99-64"><a href="#cb99-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"casual"</span> <span class="ot">=</span> <span class="st">"#FF6B6B"</span>, <span class="st">"member"</span> <span class="ot">=</span> <span class="st">"#4ECDC4"</span>),</span>
<span id="cb99-65"><a href="#cb99-65" aria-hidden="true" tabindex="-1"></a>                     <span class="at">name =</span> <span class="st">"User Type"</span>,</span>
<span id="cb99-66"><a href="#cb99-66" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Casual"</span>, <span class="st">"Member"</span>)) <span class="sc">+</span></span>
<span id="cb99-67"><a href="#cb99-67" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb99-68"><a href="#cb99-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size_continuous</span>(<span class="at">name =</span> <span class="st">"Trip Count"</span>,</span>
<span id="cb99-69"><a href="#cb99-69" aria-hidden="true" tabindex="-1"></a>                       <span class="at">range =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">10</span>),</span>
<span id="cb99-70"><a href="#cb99-70" aria-hidden="true" tabindex="-1"></a>                       <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">comma_format</span>()) <span class="sc">+</span></span>
<span id="cb99-71"><a href="#cb99-71" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb99-72"><a href="#cb99-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">xlim =</span> <span class="fu">c</span>(bbox_start[<span class="dv">1</span>], bbox_start[<span class="dv">3</span>]), </span>
<span id="cb99-73"><a href="#cb99-73" aria-hidden="true" tabindex="-1"></a>           <span class="at">ylim =</span> <span class="fu">c</span>(bbox_start[<span class="dv">2</span>], bbox_start[<span class="dv">4</span>]),</span>
<span id="cb99-74"><a href="#cb99-74" aria-hidden="true" tabindex="-1"></a>           <span class="at">expand =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb99-75"><a href="#cb99-75" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb99-76"><a href="#cb99-76" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Top 10 Start Stations by User Type"</span>,</span>
<span id="cb99-77"><a href="#cb99-77" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Chicago Bike Share System (Top 3 stations labeled with neighborhoods)"</span>) <span class="sc">+</span></span>
<span id="cb99-78"><a href="#cb99-78" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb99-79"><a href="#cb99-79" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb99-80"><a href="#cb99-80" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb99-81"><a href="#cb99-81" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb99-82"><a href="#cb99-82" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">11</span>),</span>
<span id="cb99-83"><a href="#cb99-83" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb99-84"><a href="#cb99-84" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb99-85"><a href="#cb99-85" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb99-86"><a href="#cb99-86" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb99-87"><a href="#cb99-87" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.box =</span> <span class="st">"horizontal"</span>,</span>
<span id="cb99-88"><a href="#cb99-88" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"white"</span>, <span class="at">color =</span> <span class="cn">NA</span>)</span>
<span id="cb99-89"><a href="#cb99-89" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb99-90"><a href="#cb99-90" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">""</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">""</span>)</span>
<span id="cb99-91"><a href="#cb99-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-92"><a href="#cb99-92" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(chicago_start_map)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="case_study_bikes_v1_files/figure-html/unnamed-chunk-43-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The end station patterns closely mirror the start stations, with casual users maintaining their concentration at tourist destinations and members at business district locations. This similarity likely reflects the high overall activity levels in these areas - popular neighborhoods for casual recreation and business commuting naturally become both frequent starting points and destinations for bike share trips.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get top 10 </span><span class="re">END</span><span class="co"> stations for each user type with neighborhood info</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>top_end_stations_by_user <span class="ot">&lt;-</span> all_trips[</span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>  <span class="sc">!</span><span class="fu">is.na</span>(end_station_name),</span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a>  .(<span class="at">trip_count =</span> .N),</span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a>  by <span class="ot">=</span> .(member_casual, end_station_name, end_station_id, end_lat, end_lng,</span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a>           end_primary_neighborhood, end_secondary_neighborhood)</span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a>  ][</span>
<span id="cb100-8"><a href="#cb100-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">order</span>(<span class="sc">-</span>trip_count),</span>
<span id="cb100-9"><a href="#cb100-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">head</span>(.SD, <span class="dv">9</span>),</span>
<span id="cb100-10"><a href="#cb100-10" aria-hidden="true" tabindex="-1"></a>    by <span class="ot">=</span> member_casual</span>
<span id="cb100-11"><a href="#cb100-11" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb100-12"><a href="#cb100-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-13"><a href="#cb100-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to sf object for mapping</span></span>
<span id="cb100-14"><a href="#cb100-14" aria-hidden="true" tabindex="-1"></a>top_end_stations_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(top_end_stations_by_user, </span>
<span id="cb100-15"><a href="#cb100-15" aria-hidden="true" tabindex="-1"></a>                               <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"end_lng"</span>, <span class="st">"end_lat"</span>), </span>
<span id="cb100-16"><a href="#cb100-16" aria-hidden="true" tabindex="-1"></a>                               <span class="at">crs =</span> <span class="dv">4326</span>)</span>
<span id="cb100-17"><a href="#cb100-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-18"><a href="#cb100-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate bounding box and add padding</span></span>
<span id="cb100-19"><a href="#cb100-19" aria-hidden="true" tabindex="-1"></a>bbox_end <span class="ot">&lt;-</span> <span class="fu">st_bbox</span>(top_end_stations_sf)</span>
<span id="cb100-20"><a href="#cb100-20" aria-hidden="true" tabindex="-1"></a>bbox_end[<span class="dv">1</span>] <span class="ot">&lt;-</span> bbox_end[<span class="dv">1</span>] <span class="sc">-</span> padding</span>
<span id="cb100-21"><a href="#cb100-21" aria-hidden="true" tabindex="-1"></a>bbox_end[<span class="dv">2</span>] <span class="ot">&lt;-</span> bbox_end[<span class="dv">2</span>] <span class="sc">-</span> padding</span>
<span id="cb100-22"><a href="#cb100-22" aria-hidden="true" tabindex="-1"></a>bbox_end[<span class="dv">3</span>] <span class="ot">&lt;-</span> bbox_end[<span class="dv">3</span>] <span class="sc">+</span> padding</span>
<span id="cb100-23"><a href="#cb100-23" aria-hidden="true" tabindex="-1"></a>bbox_end[<span class="dv">4</span>] <span class="ot">&lt;-</span> bbox_end[<span class="dv">4</span>] <span class="sc">+</span> padding</span>
<span id="cb100-24"><a href="#cb100-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-25"><a href="#cb100-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Get top 3 end stations for labels</span></span>
<span id="cb100-26"><a href="#cb100-26" aria-hidden="true" tabindex="-1"></a>top_end_stations_for_labels <span class="ot">&lt;-</span> top_end_stations_sf <span class="sc">|&gt;</span> </span>
<span id="cb100-27"><a href="#cb100-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(member_casual) <span class="sc">|&gt;</span> </span>
<span id="cb100-28"><a href="#cb100-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(trip_count, <span class="at">n =</span> <span class="dv">3</span>) <span class="sc">|&gt;</span> </span>
<span id="cb100-29"><a href="#cb100-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb100-30"><a href="#cb100-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-31"><a href="#cb100-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Create </span><span class="re">END</span><span class="co"> stations map with labels and neighborhood annotations</span></span>
<span id="cb100-32"><a href="#cb100-32" aria-hidden="true" tabindex="-1"></a>chicago_end_map <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb100-33"><a href="#cb100-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> neighborhoods_clean, </span>
<span id="cb100-34"><a href="#cb100-34" aria-hidden="true" tabindex="-1"></a>          <span class="at">fill =</span> <span class="st">"lightgray"</span>, </span>
<span id="cb100-35"><a href="#cb100-35" aria-hidden="true" tabindex="-1"></a>          <span class="at">color =</span> <span class="st">"white"</span>, </span>
<span id="cb100-36"><a href="#cb100-36" aria-hidden="true" tabindex="-1"></a>          <span class="at">size =</span> <span class="fl">0.3</span>, </span>
<span id="cb100-37"><a href="#cb100-37" aria-hidden="true" tabindex="-1"></a>          <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb100-38"><a href="#cb100-38" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb100-39"><a href="#cb100-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> top_end_stations_sf, </span>
<span id="cb100-40"><a href="#cb100-40" aria-hidden="true" tabindex="-1"></a>          <span class="fu">aes</span>(<span class="at">color =</span> member_casual, <span class="at">size =</span> trip_count), </span>
<span id="cb100-41"><a href="#cb100-41" aria-hidden="true" tabindex="-1"></a>          <span class="at">alpha =</span> <span class="fl">0.9</span>) <span class="sc">+</span></span>
<span id="cb100-42"><a href="#cb100-42" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb100-43"><a href="#cb100-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf_text</span>(<span class="at">data =</span> top_end_stations_for_labels,</span>
<span id="cb100-44"><a href="#cb100-44" aria-hidden="true" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">paste0</span>(<span class="fu">substr</span>(end_station_name, <span class="dv">1</span>, <span class="dv">15</span>), </span>
<span id="cb100-45"><a href="#cb100-45" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">if_else</span>(<span class="fu">nchar</span>(end_station_name) <span class="sc">&gt;</span> <span class="dv">15</span>, <span class="st">"..."</span>, <span class="st">""</span>))),</span>
<span id="cb100-46"><a href="#cb100-46" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> <span class="fl">2.2</span>, </span>
<span id="cb100-47"><a href="#cb100-47" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb100-48"><a href="#cb100-48" aria-hidden="true" tabindex="-1"></a>               <span class="at">fontface =</span> <span class="st">"bold"</span>,</span>
<span id="cb100-49"><a href="#cb100-49" aria-hidden="true" tabindex="-1"></a>               <span class="at">nudge_y =</span> <span class="fl">0.003</span>,</span>
<span id="cb100-50"><a href="#cb100-50" aria-hidden="true" tabindex="-1"></a>               <span class="at">check_overlap =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb100-51"><a href="#cb100-51" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb100-52"><a href="#cb100-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf_text</span>(<span class="at">data =</span> top_end_stations_for_labels,</span>
<span id="cb100-53"><a href="#cb100-53" aria-hidden="true" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">label =</span> end_primary_neighborhood),</span>
<span id="cb100-54"><a href="#cb100-54" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> <span class="fl">1.8</span>, </span>
<span id="cb100-55"><a href="#cb100-55" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">"darkblue"</span>,</span>
<span id="cb100-56"><a href="#cb100-56" aria-hidden="true" tabindex="-1"></a>               <span class="at">style =</span> <span class="st">"italic"</span>,</span>
<span id="cb100-57"><a href="#cb100-57" aria-hidden="true" tabindex="-1"></a>               <span class="at">nudge_y =</span> <span class="sc">-</span><span class="fl">0.003</span>,</span>
<span id="cb100-58"><a href="#cb100-58" aria-hidden="true" tabindex="-1"></a>               <span class="at">check_overlap =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb100-59"><a href="#cb100-59" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb100-60"><a href="#cb100-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"casual"</span> <span class="ot">=</span> <span class="st">"#FF6B6B"</span>, <span class="st">"member"</span> <span class="ot">=</span> <span class="st">"#4ECDC4"</span>),</span>
<span id="cb100-61"><a href="#cb100-61" aria-hidden="true" tabindex="-1"></a>                     <span class="at">name =</span> <span class="st">"User Type"</span>,</span>
<span id="cb100-62"><a href="#cb100-62" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Casual"</span>, <span class="st">"Member"</span>)) <span class="sc">+</span></span>
<span id="cb100-63"><a href="#cb100-63" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb100-64"><a href="#cb100-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size_continuous</span>(<span class="at">name =</span> <span class="st">"Trip Count"</span>,</span>
<span id="cb100-65"><a href="#cb100-65" aria-hidden="true" tabindex="-1"></a>                       <span class="at">range =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">9</span>),</span>
<span id="cb100-66"><a href="#cb100-66" aria-hidden="true" tabindex="-1"></a>                       <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">comma_format</span>()) <span class="sc">+</span></span>
<span id="cb100-67"><a href="#cb100-67" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb100-68"><a href="#cb100-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">xlim =</span> <span class="fu">c</span>(bbox_end[<span class="dv">1</span>], bbox_end[<span class="dv">3</span>]), </span>
<span id="cb100-69"><a href="#cb100-69" aria-hidden="true" tabindex="-1"></a>           <span class="at">ylim =</span> <span class="fu">c</span>(bbox_end[<span class="dv">2</span>], bbox_end[<span class="dv">4</span>]),</span>
<span id="cb100-70"><a href="#cb100-70" aria-hidden="true" tabindex="-1"></a>           <span class="at">expand =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb100-71"><a href="#cb100-71" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb100-72"><a href="#cb100-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Top 10 End Stations by User Type"</span>,</span>
<span id="cb100-73"><a href="#cb100-73" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Chicago Bike Share System (Top 3 stations labeled with neighborhoods)"</span>) <span class="sc">+</span></span>
<span id="cb100-74"><a href="#cb100-74" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb100-75"><a href="#cb100-75" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb100-76"><a href="#cb100-76" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb100-77"><a href="#cb100-77" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb100-78"><a href="#cb100-78" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">11</span>),</span>
<span id="cb100-79"><a href="#cb100-79" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb100-80"><a href="#cb100-80" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb100-81"><a href="#cb100-81" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb100-82"><a href="#cb100-82" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb100-83"><a href="#cb100-83" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.box =</span> <span class="st">"horizontal"</span>,</span>
<span id="cb100-84"><a href="#cb100-84" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"white"</span>, <span class="at">color =</span> <span class="cn">NA</span>)</span>
<span id="cb100-85"><a href="#cb100-85" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb100-86"><a href="#cb100-86" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">""</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">""</span>)</span>
<span id="cb100-87"><a href="#cb100-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-88"><a href="#cb100-88" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(chicago_end_map)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="case_study_bikes_v1_files/figure-html/unnamed-chunk-44-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The bar chart reveals that casual users generate significantly higher trip volumes at their top stations compared to members, with Streeter Dr &amp; Grand Ave alone accounting for nearly 50,000 trips. Member usage is more distributed across stations, reflecting their diverse commuting origins and destinations throughout the business districts.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare data for START stations bar plot with neighborhoods</span></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>start_plot_data <span class="ot">&lt;-</span> top_start_stations_by_user[</span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">order</span>(member_casual, <span class="sc">-</span>trip_count)</span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>][</span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a>  , <span class="st">`</span><span class="at">:=</span><span class="st">`</span>(</span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">rank =</span> <span class="fu">seq_len</span>(.N),</span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">station_label =</span> <span class="fu">paste0</span>(<span class="fu">seq_len</span>(.N), <span class="st">". "</span>, <span class="fu">substr</span>(start_station_name, <span class="dv">1</span>, <span class="dv">25</span>), </span>
<span id="cb101-8"><a href="#cb101-8" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">fifelse</span>(<span class="fu">nchar</span>(start_station_name) <span class="sc">&gt;</span> <span class="dv">25</span>, <span class="st">"..."</span>, <span class="st">""</span>))</span>
<span id="cb101-9"><a href="#cb101-9" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb101-10"><a href="#cb101-10" aria-hidden="true" tabindex="-1"></a>  by <span class="ot">=</span> member_casual</span>
<span id="cb101-11"><a href="#cb101-11" aria-hidden="true" tabindex="-1"></a>][</span>
<span id="cb101-12"><a href="#cb101-12" aria-hidden="true" tabindex="-1"></a>  , station_with_neighborhood <span class="sc">:</span><span class="er">=</span> <span class="fu">paste0</span>(station_label, <span class="st">"</span><span class="sc">\n</span><span class="st">("</span>, start_primary_neighborhood, <span class="st">")"</span>)</span>
<span id="cb101-13"><a href="#cb101-13" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb101-14"><a href="#cb101-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-15"><a href="#cb101-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Create START stations horizontal bar plot with neighborhood annotations</span></span>
<span id="cb101-16"><a href="#cb101-16" aria-hidden="true" tabindex="-1"></a>start_bar_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(start_plot_data, <span class="fu">aes</span>(<span class="at">x =</span> trip_count, <span class="at">y =</span> <span class="fu">reorder</span>(station_with_neighborhood, trip_count))) <span class="sc">+</span></span>
<span id="cb101-17"><a href="#cb101-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">fill =</span> member_casual), <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb101-18"><a href="#cb101-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"casual"</span> <span class="ot">=</span> <span class="st">"#FF6B6B"</span>, <span class="st">"member"</span> <span class="ot">=</span> <span class="st">"#4ECDC4"</span>),</span>
<span id="cb101-19"><a href="#cb101-19" aria-hidden="true" tabindex="-1"></a>                    <span class="at">name =</span> <span class="st">"User Type"</span>,</span>
<span id="cb101-20"><a href="#cb101-20" aria-hidden="true" tabindex="-1"></a>                    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Casual"</span>, <span class="st">"Member"</span>)) <span class="sc">+</span></span>
<span id="cb101-21"><a href="#cb101-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">comma_format</span>()) <span class="sc">+</span></span>
<span id="cb101-22"><a href="#cb101-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Top 10 Start Stations by Trip Count"</span>,</span>
<span id="cb101-23"><a href="#cb101-23" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Station names with neighborhoods in parentheses"</span>,</span>
<span id="cb101-24"><a href="#cb101-24" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Number of Trips"</span>,</span>
<span id="cb101-25"><a href="#cb101-25" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb101-26"><a href="#cb101-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb101-27"><a href="#cb101-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb101-28"><a href="#cb101-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb101-29"><a href="#cb101-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb101-30"><a href="#cb101-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb101-31"><a href="#cb101-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">7</span>),</span>
<span id="cb101-32"><a href="#cb101-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.major.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb101-33"><a href="#cb101-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>()</span>
<span id="cb101-34"><a href="#cb101-34" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb101-35"><a href="#cb101-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>member_casual, <span class="at">scales =</span> <span class="st">"free"</span>, <span class="at">ncol =</span> <span class="dv">1</span>)</span>
<span id="cb101-36"><a href="#cb101-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-37"><a href="#cb101-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare data for </span><span class="re">END</span><span class="co"> stations bar plot with neighborhoods</span></span>
<span id="cb101-38"><a href="#cb101-38" aria-hidden="true" tabindex="-1"></a>end_plot_data <span class="ot">&lt;-</span> top_end_stations_by_user[</span>
<span id="cb101-39"><a href="#cb101-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">order</span>(member_casual, <span class="sc">-</span>trip_count)</span>
<span id="cb101-40"><a href="#cb101-40" aria-hidden="true" tabindex="-1"></a>][</span>
<span id="cb101-41"><a href="#cb101-41" aria-hidden="true" tabindex="-1"></a>  , <span class="st">`</span><span class="at">:=</span><span class="st">`</span>(</span>
<span id="cb101-42"><a href="#cb101-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">rank =</span> <span class="fu">seq_len</span>(.N),</span>
<span id="cb101-43"><a href="#cb101-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">station_label =</span> <span class="fu">paste0</span>(<span class="fu">seq_len</span>(.N), <span class="st">". "</span>, <span class="fu">substr</span>(end_station_name, <span class="dv">1</span>, <span class="dv">25</span>), </span>
<span id="cb101-44"><a href="#cb101-44" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">fifelse</span>(<span class="fu">nchar</span>(end_station_name) <span class="sc">&gt;</span> <span class="dv">25</span>, <span class="st">"..."</span>, <span class="st">""</span>))</span>
<span id="cb101-45"><a href="#cb101-45" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb101-46"><a href="#cb101-46" aria-hidden="true" tabindex="-1"></a>  by <span class="ot">=</span> member_casual</span>
<span id="cb101-47"><a href="#cb101-47" aria-hidden="true" tabindex="-1"></a>][</span>
<span id="cb101-48"><a href="#cb101-48" aria-hidden="true" tabindex="-1"></a>  , station_with_neighborhood <span class="sc">:</span><span class="er">=</span> <span class="fu">paste0</span>(station_label, <span class="st">"</span><span class="sc">\n</span><span class="st">("</span>, end_primary_neighborhood, <span class="st">")"</span>)</span>
<span id="cb101-49"><a href="#cb101-49" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb101-50"><a href="#cb101-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-51"><a href="#cb101-51" aria-hidden="true" tabindex="-1"></a><span class="co"># Create </span><span class="re">END</span><span class="co"> stations horizontal bar plot with neighborhood annotations</span></span>
<span id="cb101-52"><a href="#cb101-52" aria-hidden="true" tabindex="-1"></a>end_bar_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(end_plot_data, <span class="fu">aes</span>(<span class="at">x =</span> trip_count, <span class="at">y =</span> <span class="fu">reorder</span>(station_with_neighborhood, trip_count))) <span class="sc">+</span></span>
<span id="cb101-53"><a href="#cb101-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">fill =</span> member_casual), <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb101-54"><a href="#cb101-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"casual"</span> <span class="ot">=</span> <span class="st">"#FF6B6B"</span>, <span class="st">"member"</span> <span class="ot">=</span> <span class="st">"#4ECDC4"</span>),</span>
<span id="cb101-55"><a href="#cb101-55" aria-hidden="true" tabindex="-1"></a>                    <span class="at">name =</span> <span class="st">"User Type"</span>,</span>
<span id="cb101-56"><a href="#cb101-56" aria-hidden="true" tabindex="-1"></a>                    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Casual"</span>, <span class="st">"Member"</span>)) <span class="sc">+</span></span>
<span id="cb101-57"><a href="#cb101-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">comma_format</span>()) <span class="sc">+</span></span>
<span id="cb101-58"><a href="#cb101-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Top 10 End Stations by Trip Count"</span>,</span>
<span id="cb101-59"><a href="#cb101-59" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Station names with neighborhoods in parentheses"</span>,</span>
<span id="cb101-60"><a href="#cb101-60" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Number of Trips"</span>,</span>
<span id="cb101-61"><a href="#cb101-61" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb101-62"><a href="#cb101-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb101-63"><a href="#cb101-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb101-64"><a href="#cb101-64" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb101-65"><a href="#cb101-65" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb101-66"><a href="#cb101-66" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb101-67"><a href="#cb101-67" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">7</span>),</span>
<span id="cb101-68"><a href="#cb101-68" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.major.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb101-69"><a href="#cb101-69" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>()</span>
<span id="cb101-70"><a href="#cb101-70" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb101-71"><a href="#cb101-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>member_casual, <span class="at">scales =</span> <span class="st">"free"</span>, <span class="at">ncol =</span> <span class="dv">1</span>)</span>
<span id="cb101-72"><a href="#cb101-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-73"><a href="#cb101-73" aria-hidden="true" tabindex="-1"></a><span class="co"># Display bar plots side by side</span></span>
<span id="cb101-74"><a href="#cb101-74" aria-hidden="true" tabindex="-1"></a>combined_bar_plots <span class="ot">&lt;-</span> <span class="fu">grid.arrange</span>(start_bar_plot, end_bar_plot, <span class="at">ncol =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="case_study_bikes_v1_files/figure-html/unnamed-chunk-45-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(combined_bar_plots)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>TableGrob (1 x 2) "arrange": 2 grobs
  z     cells    name           grob
1 1 (1-1,1-1) arrange gtable[layout]
2 2 (1-1,2-2) arrange gtable[layout]</code></pre>
</div>
</div>
</section>
</section>
<section id="conclusion-and-recommendations" class="level1">
<h1>Conclusion and Recommendations</h1>
<section id="key-insights" class="level2">
<h2 class="anchored" data-anchor-id="key-insights">Key Insights</h2>
<p>The analysis reveals fundamental behavioral differences between casual riders and annual members that directly inform conversion strategies:</p>
<p><strong>Casual Users are Recreational-Focused:</strong></p>
<ul>
<li><p>Take 65% longer trips on average, indicating leisure use rather than purposeful transportation</p></li>
<li><p>Show strong weekend preference (37.7% of rides on weekends vs.&nbsp;weekdays)</p></li>
<li><p>Concentrate at tourist attractions and lakefront locations</p></li>
<li><p>Peak usage during summer months when recreational activities are most appealing</p></li>
</ul>
<p><strong>Members are Commuter-Focused:</strong></p>
<ul>
<li><p>Consistent usage patterns aligned with work schedules (rush hour peaks, weekday preference)</p></li>
<li><p>Shorter, more efficient trips suggesting routine transportation needs</p></li>
<li><p>Station preferences in business districts (River North, West Loop)</p></li>
<li><p>Year-round usage stability indicating essential transportation dependence</p></li>
</ul>
</section>
<section id="strategic-recommendations" class="level2">
<h2 class="anchored" data-anchor-id="strategic-recommendations">Strategic Recommendations</h2>
<section id="targeted-weekend-marketing-campaign" class="level3">
<h3 class="anchored" data-anchor-id="targeted-weekend-marketing-campaign">1. Targeted Weekend Marketing Campaign</h3>
<p>Since casual users are most active on weekends, launch weekend-specific promotional campaigns highlighting the convenience and cost savings of annual membership for regular weekend riders.</p>
</section>
<section id="seasonal-conversion-strategy" class="level3">
<h3 class="anchored" data-anchor-id="seasonal-conversion-strategy">2. Seasonal Conversion Strategy</h3>
<p>Capitalize on the summer peak (July-August) when casual usage is highest. Offer limited-time summer membership discounts or trial periods to capture users during their most active period.</p>
</section>
<section id="location-based-interventions" class="level3">
<h3 class="anchored" data-anchor-id="location-based-interventions">3. Location-Based Interventions</h3>
<ul>
<li><p><strong>At Tourist Stations:</strong> Install digital displays at high-traffic casual stations (Streeter Dr &amp; Grand Ave, Millennium Park) showing membership benefits and cost comparisons</p></li>
<li><p><strong>Commuter Route Promotion:</strong> For casual users who start using commuter-focused stations, trigger targeted offers highlighting commuting benefits</p></li>
</ul>
</section>
<section id="usage-pattern-incentives" class="level3">
<h3 class="anchored" data-anchor-id="usage-pattern-incentives">4. Usage Pattern Incentives</h3>
<p>Create membership tiers or benefits that appeal to longer-ride preferences:</p>
<ul>
<li><p>“Explorer Membership” with extended time allowances</p></li>
<li><p>Weekend bonus programs</p></li>
<li><p>Partnerships with tourist attractions for member discounts</p></li>
</ul>
</section>
<section id="behavioral-nudging" class="level3">
<h3 class="anchored" data-anchor-id="behavioral-nudging">5. Behavioral Nudging</h3>
<p>Since casual users already demonstrate high engagement (longer rides, consistent weekend usage), they show strong service satisfaction. Target these engaged users with personalized conversion offers based on their usage frequency and patterns.</p>
</section>
</section>
<section id="expected-outcomes" class="level2">
<h2 class="anchored" data-anchor-id="expected-outcomes">Expected Outcomes</h2>
<p>Implementing these data-driven strategies should increase conversion rates by:</p>
<ul>
<li><p>Targeting casual users during their peak engagement periods</p></li>
<li><p>Addressing their specific usage patterns and preferences</p></li>
<li><p>Leveraging their existing high satisfaction and engagement levels</p></li>
<li><p>Providing value propositions aligned with their recreational usage needs</p></li>
</ul>
<p>The clear behavioral distinctions identified in this analysis provide a strong foundation for developing targeted marketing campaigns that speak directly to casual users’ motivations and usage patterns.</p>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>